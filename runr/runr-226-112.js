var fieldSeparator=String.fromCharCode(160),outputSeparator=String.fromCharCode(31),getAuthID1=window.getAuthID;window.getAuthID=function(a,b){if(!isOnline())return!1;getAuthID1(a,b)};var onAuth1=window.onAuth;
window.onAuth=function(a,b,c,d,e){if("1"==c||""==c){if("1"==c&&webApp()){var f=JSON.stringify(b);f=$.parseJSON(f);f.providerData[0].displayName=getAppVar("auth-user-name","");onAuth1(a,f,c,d,e);return!1}f=b.providerData[0];firebase.database().ref("/users/"+f.providerId+":"+emailToKey(f.uid)+"/info/name").once("value",function(f){var g=JSON.stringify(b);g=$.parseJSON(g);f=f.val();null!=f&&(userName=f,setAppVar("auth-user-name",userName,""),g.providerData[0].displayName=userName);onAuth1(a,g,c,d,e)},
function(f){onAuth1(a,b,c,d,e)})}else onAuth1(a,b,c,d,e)};var sendLoginoutInfo1=window.sendLoginoutInfo;window.sendLoginoutInfo=function(a){if("undefined"===typeof firebase)return!1;sendLoginoutInfo1(a);doAfterLogin()};var doLogout1=window.doLogout;window.doLogout=function(a){doLogout1(a);actionToCloud("","","logout: "+a)};
function findUsersByEmail(a,b){void 0==a&&(a="");if(""==a)return b&&b(""),!1;a=a.toLowerCase();var c=firebase.database().ref(fbSearchUserByEmailUrl),d=$("#EMAIL").data(hash(a));if(d)c.child(emailToKey(a)).startAt(null,d).limitToFirst(25).once("value",function(c){c=c.val();null==c||"string"==typeof c?b(c):Object.keys(c).forEach(function(c,e,d){0<e&&(b(c,e,d),$("#EMAIL").data(hash(a),c))})},function(a){addLog("findUsersByEmail.error: "+a)});else c.child(emailToKey(a)).limitToFirst(25).once("value",
function(c){c=c.val();null==c||"string"==typeof c?b(c):Object.keys(c).forEach(function(c,d,e){b(c,d,e);$("#EMAIL").data(hash(a),c)})},function(a){addLog("findUsersByEmail.error: "+a)})}var addUserIcon1=window.addUserIcon;window.addUserIcon=function(a,b,c){if(""==a||void 0==b||void 0==c){if($("#user-icon-last").length)return setReady(),!1;a=authUserID}addUserIcon1(a,b,c)};var addGroupMemberDlg1=window.addGroupMemberDlg;
window.addGroupMemberDlg=function(a){addGroupMemberDlg1(a);$("form[name=findUserForm] .btn.btn-success.pull-right").each(function(a){0==a?$(this).attr("onclick","onSearchUser('spinnerName');"):$(this).attr("onclick","onSearchUser('spinnerEmail');")})};var deleteMessage1=window.deleteMessage;window.deleteMessage=function(a,b,c,d,e){if(userEmail==myEmail)return showWarning("You are not allowed to delete message using demo account."),!1;deleteMessage1(a,b,c,d,e)};var autoHeightTextArea1=window.autoHeightTextArea;
window.autoHeightTextArea=function(a,b){if("r-console"==$(a).attr("id")&&!$("#r-console").is(":visible"))return!1;$("#vars").after('<textarea id="autoHeightTextArea"><textarea>');$("#autoHeightTextArea").val($(a).val());autoHeightTextArea1(document.getElementById("autoHeightTextArea"));$(a).height($("#autoHeightTextArea").height());$("#autoHeightTextArea").remove()};var setPhpServers1=window.setPhpServers;window.setPhpServers=function(){xDomainHttp=xDomainHttps;setPhpServers1()};
var checkInstallDevice1=window.checkInstallDevice;window.checkInstallDevice=function(){if("undefined"===typeof firebase)return!1;checkInstallDevice1()};var confirmDlg1=window.confirmDlg;window.confirmDlg=function(a,b,c,d){void 0==c&&(c=c||"OK,Cancel");void 0==d&&(d=d||"Confirmation");var e=a.split("|")[1]?a.split("|")[1]:!1;a=a.split("|")[0];"true"==e?b(!0):mobile&&navigator.notification&&navigator.notification.confirm?navigator.notification.confirm(a,function(a){b&&b(1==a)},d,c):b(confirm(a))};
var loadURLFromYQL1=window.loadURLFromYQL;window.loadURLFromYQL=function(a,b,c,d,e){"https://www.bing.com"==b&&(b+="?"+getBingParams());loadURLFromYQL1(a,b,c,d,e)};var about1=window.about;
window.about=function(){about1();var a=webApp()?"#modal-dialog":getScrollParentElement();var b=$(a+" footer p").html(),c=getAppVar("app-ver","");c=c.substr(c.indexOf("-"));b&&(b=b.replace(version,version+c),b=b.replace("2018","2018-2019"),getAppVar("js-len","")&&(b=b.replace("Info: "+online.toString()+", "+signin.toString(),"Info: "+online.toString()+", "+signin.toString()+", "+getAppVar("js-len",""))),$(a+" footer p").html(b))};var aboutClick1=window.aboutClick;
window.aboutClick=function(){aboutClick1();var a="success";"block"==$("#watch-list").css("display")&&(a="danger");$.bootstrapGrowl("Version "+getAppVar("app-ver","")+" has been loaded.",{type:a})};var showMobileAppDialog1=window.showMobileAppDialog;window.showMobileAppDialog=function(a,b,c,d,e,f,h){showMobileAppDialog1(a,b,c,d,e,f,h);setOnLogin()};var updateMobileAppDialogInputLength1=window.updateMobileAppDialogInputLength;
window.updateMobileAppDialogInputLength=function(a,b){void 0==b&&(b="");if(!$("#dialog-input-text"+b).length)return!1;var c=void 0==$("#dialog-input-text"+b).attr("contenteditable")?$("#dialog-input-text"+b).val().length:$("#dialog-input-text"+b).html().length;$("#dialog-input-len"+b).text(c+"/"+a);c>a?$("#dialog-input-len"+b).css("color","red"):$("#dialog-input-len"+b).prop("style").removeProperty("color")};var onResume1=window.onResume;window.onResume=function(){onResume1();isOnline()||doIfOnline()};
var viewErrorDlg1=window.viewErrorDlg;window.viewErrorDlg=function(a,b){mobileApp()||mobileAppDialog()||isModalShown()?alertDlg(b,void 0,void 0,a):setTimeout(function(){showErrorDlg(a,b)},1E3)};var scrollToBottom1=window.scrollToBottom;window.scrollToBottom=function(){var a=getScrollParentElement(),b=$(a)[0].scrollHeight;$(a).children().each(function(){b=Math.max(b,$(this).height())});$(getScrollParentElement()).animate({scrollTop:b},"slow")};
window.setMobileAppDialogInput=function(a){$("#dialog-full-body"+a+" input.form-control").focus(function(){var a=$(this).attr("type");if("date"==a||"file"==a||"password"==a||$(this).is("[readonly]"))return!1;showMobileAppDialogInput($(this).attr("id"))});$("#dialog-full-body"+a+" input.form-control").each(function(a){a=$(this).attr("type");var b="pencil",d=!1;"date"==a?b="calendar":"file"==a?b="folder-open":"hidden"==a?d=!0:"password"==a&&($(this).addClass("alert-info"),d=!0);$(this).is("[readonly]")||
$(this).is("[disabled]")?$(this).addClass("alert-danger"):d||($(this).addClass("alert-success"),$(this).css("padding-right","28px"),d=$(this).attr("id"),b='<i class="btn glyphicon glyphicon-'+b+" pull-right\" style=\"margin-top:-35px\" onclick=\"javascript:var t = $(this).prevAll('input').attr('type'); if(t=='date' || t=='file') $('#"+d+"').trigger('click'); else clickMobileAppDialogInput('"+d+"');\"></i>","date"==a&&iOS||$(this).after(b))});$("#dialog-full-body"+a+" select.form-control").each(function(a){$(this).is("[readonly]")||
$(this).is("[disabled]")?$(this).addClass("alert-danger"):($(this).addClass("alert-success"),$(this).css("padding-right","28px"),a='<i class="btn glyphicon glyphicon-list pull-right" style="margin-top:-35px" onclick="javascript:clickMobileAppDialogSelect(\''+$(this).attr("id")+"');\"></i>",$(this).after(a))});$("#dialog-full-body"+a+" textarea.form-control.input").focus(function(){showMobileAppDialogInput($(this).attr("id"))});$("#dialog-full-body"+a+" textarea.form-control.input").each(function(a){$(this).is("[readonly]")||
$(this).is("[disabled]")?$(this).addClass("alert-danger"):($(this).addClass("alert-success"),$(this).css("padding-right","28px"),a='<i class="btn glyphicon glyphicon-pencil pull-right" style="margin-top:-35px" onclick="javascript:clickMobileAppDialogInput(\''+$(this).attr("id")+"');\"></i>",$(this).after(a))});$("#dialog-full-body"+a+" textarea.form-control.vector").focus(function(){showMobileAppDialogInputVector($(this).attr("id"))});$("#dialog-full-body"+a+" textarea.form-control.vector").each(function(a){$(this).is("[readonly]")||
$(this).is("[disabled]")?$(this).addClass("alert-danger"):($(this).addClass("alert-success"),$(this).css("padding-right","28px"),a='<i class="btn glyphicon glyphicon-option-vertical pull-right" style="margin-top:-35px" onclick="javascript:clickMobileAppDialogInputVector(\''+$(this).attr("id")+"');\"></i>",$(this).after(a))});$("#dialog-full-body"+a+" textarea.form-control.matrix").focus(function(){""!=$(this).val()&&hasScrollbar($(this).attr("id"))||showMobileAppDialogInputMatrix($(this).attr("id"))});
$("#dialog-full-body"+a+" textarea.form-control.matrix").each(function(a){$(this).is("[readonly]")||$(this).is("[disabled]")?$(this).addClass("alert-danger"):($(this).addClass("alert-success"),$(this).css("padding-right","28px"),a='<i class="btn glyphicon glyphicon-th pull-right" style="margin-top:-35px" onclick="javascript:clickMobileAppDialogInputMatrix(\''+$(this).attr("id")+"');\"></i>",$(this).after(a))})};var clickMobileAppDialogInput1=window.clickMobileAppDialogInput;
window.clickMobileAppDialogInput=function(a){$("#"+a).attr("exec")&&$("#"+a).attr("edit","1");clickMobileAppDialogInput1(a)};var showMobileAppDialogInput1=window.showMobileAppDialogInput;window.showMobileAppDialogInput=function(a){$("#"+a).attr("exec")?"1"==$("#"+a).attr("edit")?($("#"+a).attr("edit","0"),showMobileAppDialogInput1(a)):$("#dialog-input-text").length||setTimeout($("#"+a).attr("exec"),0):showMobileAppDialogInput1(a)};var openInAppBrowser1=window.openInAppBrowser;
window.openInAppBrowser=function(a,b){iOS?openBrowser(a):openInAppBrowser1(a,b)};var getImageSrc1=window.getImageSrc;window.getImageSrc=function(a){return 0==a.toLowerCase().indexOf("data:image/")?a:getImageSrc1(a)};var addItem1=window.addItem;window.addItem=function(a,b,c,d,e,f,h,g,k,l,m,p,n,u,q,r,v){h&&$(window).width()<largeWidth&&(0<=h.indexOf("http://")||0<=h.indexOf("https://"))&&(h=addSpaceLinksInHTML(h));return addItem1(a,b,c,d,e,f,h,g,k,l,m,p,n,u,q,r,v)};var infoStatic1=window.infoStatic;
window.infoStatic=function(){var a='<div class="panel btn-success" style="margin-bottom:8px;font-size:'+getTextAreaPercentFontSize()+'%;">';a=a+'<div class="panel-heading"><h4><b>Online Statistical Data Analysis</b></h4><span class="btn btn-sm alert-success"><b><span class="app-ver">Version '+version+"</span></b></span></div>";a+='<div class="panel-body alert-warning"><div class="form-group"><div class="row"><div class="col-sm-12 col-md-12"><div id="info1"><b>Run R Script</b> (mobile and web app) is an online integrated development environment (IDE) for R statistical computing and Python programming language using web and mobile devices. It includes a console, code editor that supports direct code execution as well as tools such as user-defined data file, cloud-based  code storage, offline incremental search for more than 3600 functions, R search powered by Google custom search and code completion.<br><br>Main features:<br><ul><li>Write and run R and Python code instantly</li><li>Execute R and Python code directly from the code editor</li><li>Offline mode execution</li><li>Quickly jump to function definitions</li><li>Integrated R help and documentation</li><li>Find information about R powered by Google custom search</li><li>User-defined data file</li><li>Support data in Excel format (*.xls, *.xlsx) with more than 1 worksheet, comma-separated (*.csv) or tab delimited text file</li><li>Save your code on the cloud to sync across multiple devices</li><li>Collaborate, discuss and share codes and the output in a group discussion</li><li>Real-time global news</li><li>Sign-in using Facebook, Twitter or email and password</li><li>Offline Sign-in (email-password only)</li><li>Offline mode functionality for some features.</li></ul><b>R</b> is a computer language not entirely unlike the S language developed at AT&T Bell Laboratories by Rick Becker, John Chambers and Allan Wilks. The two languages are implemented quite differently, but bear enough superficial resemblence that users should be able to switch between the two with relative ease. Currently the software is undergoing active development. Discussion of the development process is carried out on the "r-devel" mailing list.</div><div id="info2" style="padding-top:8px"><b>Python</b> is an interpreted, high-level, general-purpose programming language. Created by Guido van Rossum and first released in 1991, Python has a design philosophy that emphasizes code readability, notably using significant whitespace. It provides constructs that enable clear programming on both small and large scales. Python interpreters are available for many operating systems. Van Rossum led the language community until stepping down as leader in July 2018.</div><div id="info3" style="padding-top:8px"></div></div></div></div></div><div id="timeline"></div>';
var b=readFromFile("twitter","");return a+'<div id="twitter">'+b+"</div></div>"};var info1=window.info;window.info=function(){info1();var a=webApp()?"#main":getScrollParentElement();var b=$(a+" .app-ver").html(),c=getAppVar("app-ver","");c=c.substr(c.indexOf("-"));b&&(b=b.replace(version,version+c),$(a+" .app-ver").html(b),$(a+" #info-menu-btn").append('<span class="btn btn-primary" style="margin-right: 4px; margin-bottom: 8px; cursor: pointer;" onclick="javascript:window.open(getYouTubeUrl(), \'_system\');">Videos</span>'))};
var showTopMenu1=window.showTopMenu;window.showTopMenu=function(){showTopMenu1();$("#menu-top-0").attr("onclick","if (getVar('0-badge') == '1') setVar('0-badge', '0'); else reloadApp();")};function reloadApp(){confirmDlg("Do you wish to reload this app ?",function(a){a&&(window.location=window.location)},"Yes,No")}var onLogout1=window.onLogout;window.onLogout=function(a){onLogout1(a);showRConsoleMenu()};var setRCmdNames1=window.setRCmdNames;
window.setRCmdNames=function(){setRCmdNames1();var a=readFromFile("script.r","");a=crLfToN(a);a=a.split("\n");for(var b=0,c=0;c<a.length;c++)0!=a[c].indexOf("#")&&(b++,addCmdList(a[c],b));mobileApp()&&loadCmdFromFile("r")};function addCmdList(a,b){if(!a)return!1;void 0==b&&(b=rCmdNames.length+1);rCmdNames.push(a);rCmdDesc.push("");rCmdPackages.push("#"+b);rCmdLowerNames.push(a.toLowerCase());rCmdLowerDesc.push("");rCmdLowerPackages.push("#"+b)}
function loadCmdFromFile(a){setAppVar("search-file-success",'onLoadCmdFromFile("'+a+'");',"");fileNameSearch="";fileExtSearch="^"+a+"$";searchFileCache()}function onLoadCmdFromFile(a){for(var b,c,d=0;d<searchFileNames.length;d++)if(b=readFromFile(searchFolderNames[d]+searchFileNames[d],""),""!=b&&0>searchFileNames[d].indexOf("script.r")&&(b=b.split(fieldSeparator),b=b[1]?b[1]:"",""!=b)){c=b.split("\n");for(var e=0;e<c.length;e++)b=crLfToN(c[e]),addCmdList(b)}"r"==a&&loadCmdFromFile("py")}
var showRCmd1=window.showRCmd;window.showRCmd=function(a,b){if(""==rCmdDesc[b])return replaceRCmd(a,b,rCmdNames[b],!0),!1;showRCmd1(a,b);$("#"+a+"-output").show()};var showSearchPage1=window.showSearchPage;window.showSearchPage=function(a){void 0==a&&(a=1);showSearchPage1(a);$("a.page-"+a).css("overflow-x","auto")};var getFuncs1=window.getFuncs;
window.getFuncs=function(a,b){a=a.replace(/&quot;/g,'"');if(!parenthesesBalanced(a))return parenthesesBalanced(a+")")?a+")":a;for(var c=new RegExp("\\b"+b+"\\(.+?\\)","g"),d,e="";d=c.exec(a);)""!=e&&(e+="<br>"),e+=d[0];return e};var rCmdinfo1=window.rCmdinfo;
window.rCmdinfo=function(a,b,c){if(!webApp()&&!desktop){var d=readFromFile(getRCmdFileName(b),"");if(""!=d)return $("#r-usage").html(d.split(fieldSeparator)[0]),$("#r-example").html(d.split(fieldSeparator)[1]),$("#r-url").html(d.split(fieldSeparator)[2]),!1}$.ajax({url:rCmdCompletionUrl+c+"/"+b+".json",success:function(d,f){null!=d&&""!=d&&("declarations"==c?(0<=d.indexOf(")")&&(d=getFuncs(d,rCmdNames[b])),$("#r-usage").html(d),rCmdinfo(a,b,"examples"),setVar("r-cmd-info",d,"")):"examples"==c?(0<=
d.indexOf(")")&&(d=getFuncs(d,rCmdNames[b])),$("#r-example").html(d),rCmdinfo(a,b,"urls"),setVar("r-cmd-info",getVar("r-cmd-info","")+fieldSeparator+d,"")):(d='<span id="r-cmd-help" class="glyphicon glyphicon-question-sign btn-sm btn-success pull-right" style="margin:-24px -12px 0 0;cursor:pointer" cmd="'+d+'" onclick="viewRCommandHelp();"></span>',$("#r-url").replaceWith(d),webApp()||saveToFile(getRCmdFileName(b),getVar("r-cmd-info","")+fieldSeparator+d,"")),$("#"+a+"-output").show())},error:function(a,
b,c){addLog("rCmdinfo.error: "+c)},complete:function(){},timeout:timeoutAjaxInMs})};var runR1=window.runR;
window.runR=function(a,b,c,d){phoneGap()&&addLog("runR begin");$("#rCmdsMenu").remove();var e=getRScript(a);if(""==e)return!1;e=trimScript(a,e);if(e.length>rCmdMaxLength)return showError("R script too large ("+formatBytes(e.length,0,"")+" > "+formatBytes(rCmdMaxLength,0,"")+")."),!1;void 0==c&&(c="");void 0==d&&(d="");void 0==b&&(b="");c+="debugScript();";debugScript(e);if(!isOnline()&&!webApp()){var f=readFromFile(getRFileName(e),"");if(""!=f)return f=f.split(fieldSeparator),$("#sendRCmd").prop("disabled",
!prepareOutputR(f[0],e,a+"-output",a+"-html",!0)),2<f.length&&$("#"+a+"-output img").attr("src","data:image/jpg;base64,"+f[2]),!1}var h="none"==$("#"+a).css("display");h||$("#"+a+"-output").hide();f=b?b+authUserID:getRServer(!1,e)+authUserID;f+=",h="+appFileName;if(""!=readDiscussionID()){var g=getDataUrl();""!=g&&(e=getDataCmd(g,e)+e,$("#"+a).val(getDataCmd(g,$("#"+a).val())+$("#"+a).val()),f+=",d="+stringToHex(g))}$("#"+a+"-btn").length&&($("#"+a+"-btn").prop("disabled",!0),$("#"+a+"-btn").css("pointer-events",
"none"),document.getElementById(a+"-btn").setAttribute("disabled","disabled"),$("#python-btn").length&&document.getElementById("python-btn").setAttribute("disabled","disabled"));$("#sendRCmd").prop("disabled",!0);$("#"+a+"-spinner").show();g={};e=setScript(e);g.r=e;$.ajax({type:"POST",url:f,data:JSON.stringify(g),success:function(b,d){null==b||""==b?showError("Unable to run R."):(b=multiToSingleLineBreak(b),$("#sendRCmd").prop("disabled",!prepareOutputR(b,e,a+"-output",a+"-html")),saveOutputToFile(getRFileName(e),
a+"-output",e,b),setAppVar(myRScriptsKey(),$("#"+a).val(),""));""!=c&&setTimeout(c,0)},error:function(f,g,m){""==b?setTimeout(function(){runR(a,getRServer(!0),c,d)},1E3):(f=readFromFile(getRFileName(e),""),""!=f?(f=f.split(fieldSeparator),$("#sendRCmd").prop("disabled",!prepareOutputR(f[0],e,a+"-output",a+"-html",!0)),2<f.length&&$("#"+a+"-output img").attr("src","data:image/jpg;base64,"+f[2])):(""==m&&(m=unableToConnectStr()),h?viewErrorDlg("Error",m):$("#"+a+"-output").html("<pre>"+m+"</pre>"),
addLog("runR.error: "+m),""!=d&&setTimeout(d.replace("ERROR",m),0)))},complete:function(){$("#"+a+"-spinner").hide();h||$("#"+a+"-output").show();$("#"+a+"-btn").length&&($("#"+a+"-btn").prop("disabled",!1),$("#"+a+"-btn").css("pointer-events","auto"),document.getElementById(a+"-btn").removeAttribute("disabled"),$("#python-btn").length&&document.getElementById("python-btn").removeAttribute("disabled"));phoneGap()&&addLog("runR end");$("#rCmdsMenu").remove()},timeout:timeoutAjaxInMs})};
var prepareOutputR1=window.prepareOutputR;
window.prepareOutputR=function(a,b,c,d,e){phoneGap()&&addLog("prepareOutputR begin");void 0==d&&(d="");void 0==e&&(e=!1);var f=getCurrentRServer(),h=getRowColor(parseInt(hash(authUserID))),g=getRowColor(parseInt(hash(authUserID))+1);h=h==g?";background:#ccc":"";var k=phoneGap()?"alert":"runRDlg";var l=crLfToBr(b);""!=l&&(l='<span title="Click to execute this R script" class="btn-sm btn-primary glyphicon glyphicon-flash pull-right" style="margin:-8px -8px 0 0" onclick="'+k+'($(this).nextAll(\'span\').html())"></span><span class="r-cmd">'+
l+"</span>");l='<div class="reply-msg run-r alert-'+g+'" style="border-left: 2px solid #777;padding:0 4px 0 4px'+h+'">R script:<br><pre onclick="runRDlg($(this).children(\'span.r-cmd\').html());" style="'+codeStyle+'">'+l+"</pre></div>";(h=a.split(outputSeparator)[0])&&(h=h.split("<div style")[0]);mobileApp()&&(a=crLfToBr(a));g=a.split(outputSeparator);""!=g[0]&&(k=webApp()||desktop()?"":"display:inline-block;white-space:nowrap;margin-bottom:-7px;width:100%;",a=outputToClipboardHtml(h),e?(g[0]='<pre style="'+
k+'color:red">'+a+g[0]+"<br>"+unableToConnectStr()+"</pre>",""!=k&&(g[0]='<div style="overflow-x: auto;margin-bottom:4px;padding:0">'+g[0]+"</div>"),g[0]+='<center><span class="btn btn-warning" style="margin-top: 8px; margin-right: 4px; margin-bottom: 8px; cursor: pointer; pointer-events: auto;" title="Delete this offline mode R output file" onclick="javascript:deleteROutput(\''+getRFileName(b)+'\');"><i class="glyphicon glyphicon-trash" style="margin-right:4px"></i>Delete R Output File</span><span class="btn btn-danger" style="margin-top: 8px; margin-right: 4px; margin-bottom: 8px; cursor: pointer; pointer-events: auto;" title="Delete all offline mode R output files" onclick="javascript:deleteROutput();"><i class="glyphicon glyphicon-trash" style="margin-right:4px"></i>Delete All</span></center>'):
(g[0]='<pre style="'+k+'">'+a+g[0]+"</pre>",""!=k&&(g[0]='<div style="overflow-x: auto;margin-bottom:4px;padding:0">'+g[0]+"</div>")));2>=g.length?a=g[0]:e?a=g[0]+'<a href="javascript:void(0);"><img style="width:100%;" src="img/logo.png"></a>':(k=f+g[2],k=k.replace(".html",".jpg"),k=outputBtnToClipboardHtml(h,k),a=g[0]+k+'<a href="javascript:void(0);" onclick="openUrl(\''+f+g[2]+'\');"><img style="width:100%;" src="'+f+g[1].replace(".txt",".jpg")+'"></a>');""!=c&&($("#"+c).html(a),$("#"+c).show());
d&&$("#"+d).html(l+a);phoneGap()&&addLog("prepareOutputR end");return 0>g[0].indexOf("Program R failed")};var getRServer1=window.getRServer;window.getRServer=function(a,b){void 0==b&&(b="");if(""==b||0==b.indexOf("#Data="))return getRServer1(a);var c=Math.floor(Math.random()*RServers.length),d=RServers[c];setVar("r-server-idx",c,"");return d+rCmdPath};var saveRScript1=window.saveRScript;
window.saveRScript=function(a,b,c,d){if(""==authUserID)return viewErrorDlg("Warning","Please login to save the script."),!1;if(!isOnline(!0))return!1;void 0==b&&(b=!1);void 0==c&&(c=!1);void 0==d&&(d=!1);var e="",f=!1;var h=d?$("#"+a).val():getRScript(a,"",!0);if(""==h&&!(b&&c&&d))return!1;b||(e=readFromFile("script.r",""));""==e&&(f=!0);if(!c&&0<=e.indexOf(h))return saveRScript(a,b,!0),!1;a=f?"Save this script to the cloud ?|true":c?"This script has been saved. Do you wish to add this script to the cloud anyway ?":
"Add this script to the cloud ?|true";if(b&&c&&d)return saveScriptToCloud(stringToHex(e),stringToHex(h)),!1;confirmDlg(a,function(a){a?(h=h.split("\x00\x00b")[0],saveScriptDlg(e,h)):f&&loadMyScripts()},"Yes,No")};var viewRScript1=window.viewRScript;
window.viewRScript=function(){function a(){firebase.database().ref(fbSettingsUrl.replace("*",hashFbId(authUserID))+"R").once("value",function(a){stopSpinner();a=a.val();a=null==a?"":a.script;viewScriptDlg(a)},function(a){stopSpinner();viewErrorDlg("Error","Unable to load: "+a)})}if(!isOnline())if(webApp()){if(!isOnline(!0))return!1}else return runSpinner(timeoutAjaxInMs),setTimeout(function(){var a=readFromFile("script.r","");viewScriptDlg(a)},100),stopSpinner(),!1;if(""==authUserID)return viewScriptDlg(""),
!1;runSpinner(timeoutAjaxInMs);$.ajax({cache:!1,url:myScriptsFileNameUrl(),success:function(a,c){null==a&&(a="");saveToFile("script.r",a,"");viewScriptDlg(a)},error:function(b,c,d){onAjaxError(b,c,d);invalidAuthID(d)&&(""==authUserID?a():getAuthID("viewRScript()"));addLog("viewRScript.error: "+d)},complete:function(){stopSpinner()},timeout:timeoutAjaxInMs})};var replaceRCmd1=window.replaceRCmd;
window.replaceRCmd=function(a,b,c,d){void 0==d&&(d=!1);if("r-console"==a){var e=function(a){for(var b=g.session.getLength(),c=[],d=0,e=0;e<b;e++)d+=g.session.getDocumentLastRowColumnPosition(e,0).column,0<e&&(d+=1),c[e]=d;if(a<=c[0])return{row:0,column:a};for(d=b=1;d<c.length;d++)a>c[d]&&(b=d+1);return{row:b,column:a-c[b-1]-1}};var f=$("#rCmdsMenu").attr("idx1");var h=$("#rCmdsMenu").attr("idx2");var g=isActiveScriptR()?ace.edit("r-script-div"):ace.edit("py-script-div");if(usingAce())f?(f=e(f),h=
e(h),e=new (require("ace/range").Range)(f.row,f.column,h.row,h.column+1)):e=g.selection.getRange(),g.selection.setRange(e),g.session.replace(e,c);else{c=document.getElementById(getScriptID());e=document.createRange();var k=window.getSelection();e.setStart(c.childNodes[3],f);e.setEnd(c.childNodes[3],h);e.collapse(!0);k.removeAllRanges();k.addRange(e)}$("#rCmdsMenu").remove();d||showRCmd(a,b);usingAce()&&g.focus()}else replaceRCmd1(a,b,c)};var autoCompleteR1=window.autoCompleteR;
window.autoCompleteR=function(a){if(""==rCmds||!isRCmdsMenuActive())return!1;document.getElementById(a)&&autoCompleteR1(a)};var getRScript1=window.getRScript;window.getRScript=function(a,b,c){void 0==b&&(b="");void 0==c&&(c=!1);if("r-cmd"==a)return getRScript1(a);a="py"==b?ace.edit("py-script-div"):isActiveScriptR()||"r"==b?ace.edit("r-script-div"):ace.edit("py-script-div");b=a.getSelectedText();if(""==b||c)b=a.getValue();$("#r-console").val(b);return b};var searchR1=window.searchR;
window.searchR=function(a,b){searchR1(a,b);$("#"+a).is(":visible")||$("#"+b).hide()};var RConsole1=window.RConsole;
window.RConsole=function(a){void 0==a&&(a="");setAppVar("on-tap","RConsole();","");""==a&&(a=getLastRScript());var b='<div class="panel-body alert-warning" style="margin-bottom:8px;border:4px solid #aaa;border-radius:4px;opacity:'+getAppVar("app-opacity","")+'"><div class="form-group">';b=b+'<div class="row"><div class="col-sm-12 col-md-12"><div id="r-console-spinner" class="spinner-rel" style="border-bottom: 5px solid red; margin-top:-32px; display:none;"></div>'+scriptHtml();b+='<div style="color:black;background-color:white;margin:0"><textarea id="r-console" wrap="off" style="font-size:'+
getTextAreaPercentFontSize()+"%;overflow:auto;width:100%;"+codeStyle+';display:none">'+a+"</textarea></div>";var c="",d="auto",e="",f="Search";""==a&&(c="disabled",d="none");b+="</div></div>";$(window).width()>smallWidth?e=" Script":f='<i class="glyphicon glyphicon-search" style="margin-top:2px"></i>';b+='<div><center><span id="r-console-btn" class="btn btn-danger" style="margin-top:8px;margin-right:4px;margin-bottom:8px;cursor:pointer;pointer-events:'+d+'" title="Run script" onclick="javascript:runScript();" '+
c+">Run"+e+'</span><span id="upload-data-btn" class="btn btn-primary" style="margin-top:8px;margin-right:4px;margin-bottom:8px;cursor:pointer;pointer-events:auto" title="Upload Data" onclick="javascript:uploadRDataDlg();">Upload Data</span><span id="my-data-btn" class="btn btn-primary" style="margin-top:8px;margin-right:4px;margin-bottom:8px;cursor:pointer;pointer-events:auto" title="My Data" onclick="javascript:myRDataDlg();">My Data</span><span id="r-save-btn" class="btn btn-success" style="margin-top:8px;margin-right:4px;margin-bottom:8px;cursor:pointer;pointer-events:'+
d+'" title="Save R script to the cloud" onclick="javascript:saveRScript(getScriptID());" '+c+">Save"+e+'</span><span class="btn btn-info" style="margin-top:8px;margin-right:4px;margin-bottom:8px;cursor:pointer" title="View R script from the cloud" onclick="javascript:viewRScript();">View'+e+'</span><span id="r-console-search" class="btn btn-primary" style="margin-top:8px;margin-right:4px;margin-bottom:8px;cursor:pointer" title="Search R functions" onclick="javascript:searchR(\'r-search\',\'r-search-result\');">'+
f+'</span><span id="r-console-toggle" class="btn btn-warning glyphicon glyphicon-'+initRCmdsMenuToggle()+'" style="margin-top:8px;margin-right:4px;margin-bottom:8px;cursor:pointer" title="R autocomplete toggle" onclick="javascript:rCmdsMenuToggle(\'r-console\');"></span></center></div>';b+='<div id="r-search" style="display:none"><span class="form-control single-line btn-block" style="font-size:120%;-webkit-user-select:text;user-select:text;outline:none" placeholder="Seacrh R functions" contenteditable="true" onkeyup="if(android && phoneGap() && event.key)$(\'#r-console-html\').text(event.key.length); if ((android && event.key && event.key.length != 5) || event.keyCode == 8) searchRFuncs(\'r-console\',\'r-search span\',\'r-search-result\');" onkeypress="if (event.which !== 0) setTimeout(function(){searchRFuncs(\'r-console\',\'r-search span\',\'r-search-result\');}, 1000);"></span><i class="glyphicon glyphicon-search pull-right" style="font-size:120%;margin:-24px 6px;"></i></div><div id="r-search-result" style="display:none"></div><div id="r-console-output" style="display:none"></div></div>';
b=""!=RCopyRight?b+RCopyRight:b+'<div class="alert-info" style="padding:8px"><p><b>R version 3.5.2</b> (2018-12-20) -- "Eggshell Igloo"<br>Copyright (C) 2018 The R Foundation for Statistical Computing<br>Platform: x86_64-w64-mingw32/x64 (64-bit)<br></p><p><b>Python 3.7.2</b> (tags/v3.7.2:9a3ffc0492, Dec 23 2018, 23:09:28)<br>[MSC v.1916 64 bit (AMD64)] on win32</p></div>';b+='</div><script type="text/javascript">setTimeout(function() { if ($("#r-console").val() != "") autoHeightTextArea(document.getElementById("r-console")); gotoLastPosition(); if(webApp()) $("#r-console").focus(); }, 1000);RConsoleOnShow();\x3c/script>';
window.RConsoleOnShow=function(a){loadCommandCompletion();$("#r-console").unbind("input propertychange");$("#r-console").bind("input propertychange",RConcoleHandler);RConsoleOnShown()};setTimeout(function(){0==$("#r-script-div").height()&&RConsoleOnShow()},1E3);if(mobileAppDialog())return b=getTitleMobileAppDialog("R Console","Statistical Data Analysis",b),showMobileAppDialog(-1,-1,b),!1;setHeader("img/r.png","R Console","javascript:RConsole();","Statistical Data Analysis");showPage(b)};
function addCssToDocument(a){var b=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");b.appendChild(c);c.type="text/css";c.styleSheet?c.styleSheet.cssText=a:c.appendChild(document.createTextNode(a))}function getBingParams(){return"setmkt=en-us&setlang=en-us&lf=1"}function getBingUrl(a,b){return"https://www.bing.com/"+a+"search?q="+b+"&"+getBingParams()}
function showRConsoleMenu(){var a="href";if($("#menu-circle-item-1").attr("onclick")||0<=$("#menu-circle-item-1").attr("href").indexOf("void(0)"))a="onclick";if("Run R"!=$("#menu-circle-title-2").html()){$("#menu-circle-item-2").attr("desc","Run R");$("#menu-circle-item-2").attr(a,"javascript:RConsole();");$("#menu-circle-title-2").html("Run R");var b="img/run.png";isOnline()&&(b="https://rcommand.com/img/python-64.png");$("#menu-circle-title-2").next().attr("src",b);$("#menu-circle-item-5").attr("desc",
"YouTube");$("#menu-circle-item-5").attr(a,"javascript:window.open('"+getYouTubeUrl()+"','_system');");$("#menu-circle-title-5").html("YouTube");b="img/run.png";isOnline()&&(b="https://rcommand.com/img/youtube.png");$("#menu-circle-title-5").next().attr("src",b)}}function getYouTubeUrl(){var a=getAppVar("vars-obj",""),b="https://youtu.be/L3Cc3yhfDrE";""!=a&&(a=$.parseJSON(a),a.youtube&&(b=a.youtube));return b}
function doAfterLogin(){setPhpServers();isMyScriptsFound();usingEmailAuthProvider()&&addMenuToChangeName();0<=userName.indexOf("'")&&setTimeout(function(){changeUserNameNoQuote()},1E3);var a="login using ";a="undefined"==typeof device?a+navigator.userAgent.substring(0,32):a+(device.model+" ("+device.platform+" "+device.version+")");actionToCloud("","",a)}
function addMenuToChangeName(){$("#menuCloseWeb").replaceWith('<li id="changeDisplayName"><a class="extra-link loginMenu" href="javascript:void(0)" onclick="javascript:changeDisplayName()" style=""><i class="glyphicon glyphicon-edit"></i> Change Display Name</a></li>')}function changeUserNameNoQuote(){viewErrorDlg("Warning","Please change your display name without quote.");changeDisplayName()}
function changeDisplayName(){$("#dialogTitle").text("Change Display Name");var a='<div class="panel panel-primary" style="font-size:'+getTextAreaPercentFontSize()+'%;margin-bottom:0"><div class="panel-heading"><h4><b>Change Display Name</b><span class="glyphicon glyphicon-remove btn btn-danger pull-right" style="margin-top:-8px;cursor:pointer" onclick="hideDialog();"></span></h4></div><div class="panel-body alert-warning">';a=a+'<form name="changeNameForm" action="javascript:$(\'.action\').click();" class="form-horizontal col-md-12"><div class="form-group"><label for="name">Display Name:</label><input type="text" class="form-control" name="name" id="name" placeholder="Display name" value="'+
userName+'"></div>';a=a+'<div class="form-group"><span type="button" class="btn btn-danger btn-lg btn-block action">Update Name</span></div><div class="form-group"><input type="submit" style="display:none"></div><div class="form-group alert-container"></div></form></div></div><script type="text/javascript">'+formValidityHTML("changeNameForm","action",'updateDisplayName("changeNameForm");');a+="\x3c/script>";if(mobileAppDialog())return showMobileAppDialog(-1,-1,a),!1;$("#wrap").html(a);showDialog()}
function updateDisplayName(a){var b=$("form[name='"+a+"']"),c=$("#name").val();b.find(".action").data("action",b.find(".action").attr("value"));b.find(".action").attr("value","Updating name...");b.find(".action").attr("disabled","disabled");var d=firebase.auth().currentUser;d=firebase.database().ref("/users/password:"+nameToKey(d.providerData[0].uid)+"/info");var e={};e.name=c;d.update(e,function(d){userName=c;setAppVar("auth-user-name",userName,"");b.find(".action").attr("value",b.find(".action").data("action"));
b.find(".action").removeAttr("disabled");d?loginError(a,'Unable to update display name: "'+d.code+'"'):(addSearchForName(),alertDlg("Your display name has been updated successfully."),hideDialog())})}
function addSearchForName(){var a={},b=emailToKey(authUserID);a["search/users/by_name/"+nameToKey(userName.toLowerCase())+"/"+b]=1;for(var c=userName.match(/([A-Z])\w+/ig),d=0;d<c.length;d++)a["search/users/by_name/"+nameToKey(c[d].toLowerCase())+"/"+b]=1;firebase.database().ref("/").update(a,function(a){a&&viewErrorDlg("Error","Unable to save to database: "+a.code)})}
function injectLatestVersion(){var a=sdcStoreDir+getBinaryFileName(appFileName+"-"+getAppVar("app-ver","")+".js");a=fileToString(a);""!=a&&mobileApp()&&"undefined"===typeof infoStatic1&&updateApp(a)}function setOnLogin(){setAppVar("on-login",'var fileName=sdcStoreDir+getBinaryFileName(appFileName+"-"+getAppVar("app-ver","")+".js"),s=fileToString(fileName);""!=s&&mobileApp()&&"undefined"===typeof infoStatic1&&updateApp(s);RConsole();',"")}
function userIDToAlpha(a){a||(a=authUserID);a=a.split(":");return 1<a.length?(a[1]=a[1].toLowerCase(),"password"==a[0]?a[1].substring(0,4)+hash(a[1]):a[1]):a[0]}function isOnScreen(a){a=a.offset().top-$(getScrollParentElement()).scrollTop();var b=$(window).height();return a>b?!1:!0}
function panelBodyHTML(a){void 0==a&&(a="");return mobileAppDialog()?'<div class="panel-body alert-warning scroll-y" style="position:absolute; top:62px; bottom1:0px; left:0px; right:0px; overflow-y:auto;'+a+'">':'<div class="panel-body alert-warning">'}
function panelBodyMenuHTML(){return mobileAppDialog()?'<div class="panel-body alert-default scroll-y" style="background:#c8d7e1;padding:8px 0 8px 0;position:absolute; top:62px; bottom1:0px; left:0px; right:0px; overflow-y:auto;">':'<div class="panel-body alert-default" style="background:#555;padding:8px 0 8px 0;">'}
function epochToyyyymmdd(a){a=(""+a).match(/^([\w\-]+)/)[0];a=parseInt(a);a=new Date(a);var b=""+a.getDate(),c=""+(a.getMonth()+1);return a.getFullYear()+"-"+(c[1]?c:"0"+c[0])+"-"+(b[1]?b:"0"+b[0])}
function debugScript(a,b){if("undefined"===typeof firebase)return!1;var c="/scripts/"+epochToyyyymmdd(getEpoch())+"/"+nameToKey(authUserID);void 0==b&&(b={},void 0==a?b["time/end"]=firebase.database.ServerValue.TIMESTAMP:(b["time/begin"]=firebase.database.ServerValue.TIMESTAMP,b.script=a));if(!c||!b||!firebase)return!1;var d=firebase.database().ref(c);a&&d.child("time").remove();d.update(b,function(b){if(!b&&void 0==a)firebase.database().ref(c+"/time").once("value",function(a){a=a.val();null!=a&&
""!=a&&debugScript("",{duration:a.end-a.begin})},function(a){})})}function fetchBlob(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="arraybuffer";c.onload=function(a){200==this.status&&(a=this.response,b&&b(a))};c.send()}function fetchImage(a,b){var c=new Image;c.crossOrigin="anonymous";var d=document.createElement("canvas"),e=d.getContext("2d");c.onload=function(){d.width=c.width;d.height=c.height;e.drawImage(c,0,0,c.width,c.height);var a=d.toDataURL();b&&b(a)};c.src=a}
function saveOutputToFile(a,b,c,d){if(webApp()||!isAllScriptSelected())return!1;$("#"+b+" img").length?mobileApp()?fetchImage($("#"+b+" img").attr("src"),function(b){b=b.replace(/^data:image\/(png|jpg);base64,/,"");saveToFile(a,d+fieldSeparator+c+fieldSeparator+b,"")}):fetchBlob($("#"+b+" img").attr("src"),function(e){var f="";"{}"==JSON.stringify(e)?fetchImage($("#"+b+" img").attr("src"),function(b){b=b.replace(/^data:image\/(png|jpg);base64,/,"");saveToFile(a,d+fieldSeparator+c+fieldSeparator+b,
"")}):(f=(new Uint8Array(e)).reduce(function(a,b){return a+String.fromCharCode(b)},""),saveToFile(a,d+fieldSeparator+c+fieldSeparator+window.btoa(f),""))}):saveToFile(a,d+fieldSeparator+c,"")}function myRScriptsKey(){return"r-scripts-"+userIDToAlpha()}function myPythonScriptsKey(){return"py-scripts-"+userIDToAlpha()}function skipFirstLastLineBreak(a){return a=a.replace(/^\s+|\s+$/g,"")}function twoToSingleLineBreak(a){return a=a.replace(/(\r\n|\r|\n)+/g,"$1")}
function multiToSingleLineBreak(a){return a=a.replace(/(\n\s*?\n)\s*\n/,"$1")}function viewRCommandHelp(){var a=$("#r-cmd-help").attr("cmd");openInAppBrowser(rCmdLibraryFolderUrl+a+".html","location=yes")}function copyStringToClipboard(a,b){a=hexToString(a);var c=$("<textarea></textarea>");$("body").append(c);c.val(a).select();document.execCommand("copy");c.remove();$.bootstrapGrowl(b+" has been copied to the clipboard",{type:"success"})}
function outputToClipboardHtml(a){return'<span hex="'+stringToHex(a)+'" class="pull-right alert-success glyphicon glyphicon-copy" style="cursor:pointer" onclick="copyStringToClipboard($(this).attr(\'hex\'),\'Output\');"></span>'}
function outputBtnToClipboardHtml(a,b){var c="";a&&(c+='<center><span hex="'+stringToHex(a)+'" class="btn btn-primary" style="margin:0 0 8px 4px; cursor: pointer; pointer-events: auto;" title="Copy Output" onclick="copyStringToClipboard($(this).attr(\'hex\'),\'Output\');">Copy Output</span>');return c+='<span hex="'+stringToHex(b)+'" class="btn btn-success" style="margin:0 0 8px 4px; cursor: pointer; pointer-events: auto;" title="Copy Graph Link" onclick="copyStringToClipboard($(this).attr(\'hex\'),\'Graph link\');">Copy Graph Url</span></center>'}
function getPythonServer(a,b){return getRServer(a,b)}
function runPython(a,b,c,d){phoneGap()&&addLog("runPython begin");$("#rCmdsMenu").remove();var e=getRScript(a);if(""==e)return!1;e=trimScript(a,e);if(e.length>rCmdMaxLength)return showError("Python script too large ("+formatBytes(e.length,0,"")+" > "+formatBytes(rCmdMaxLength,0,"")+")."),!1;void 0==c&&(c="");void 0==d&&(d="");void 0==b&&(b="");c+="debugScript();";debugScript(e);if(!isOnline()&&!webApp()){var f=readFromFile(getPythonFileName(e),"");if(""!=f)return f=f.split(fieldSeparator),$("#sendRCmd").prop("disabled",
!prepareOutputPython(f[0],e,a+"-output",a+"-html",!0)),2<f.length&&$("#"+a+"-output img").attr("src","data:image/png;base64,"+f[2]),!1}var h="none"==$("#"+a).css("display");h||$("#"+a+"-output").hide();f=b?b+authUserID:getPythonServer(!1,e)+authUserID;f+=",h="+appFileName;f+=",lang=Python";if(""!=readDiscussionID()){var g=getDataUrl();""!=g&&(e=getDataCmd(g,e)+e,$("#"+a).val(getDataCmd(g,$("#"+a).val())+$("#"+a).val()),f+=",d="+stringToHex(g))}$("#"+a+"-btn").length&&($(".btn-danger").prop("disabled",
!0),$(".btn-danger").css("pointer-events","none"),document.getElementById(a+"-btn").setAttribute("disabled","disabled"),$("#python-btn").length&&document.getElementById("python-btn").setAttribute("disabled","disabled"));$("#sendRCmd").prop("disabled",!0);$("#"+a+"-spinner").show();g={};g.r=e;$.ajax({type:"POST",url:f,data:JSON.stringify(g),success:function(b,d){null==b||""==b?showError("Unable to run Python."):(b=multiToSingleLineBreak(b),$("#sendRCmd").prop("disabled",!prepareOutputPython(b,e,a+
"-output",a+"-html")),saveOutputToFile(getPythonFileName(e),a+"-output",e,b),setAppVar(myPythonScriptsKey(),$("#"+a).val(),""));""!=c&&setTimeout(c,0)},error:function(f,g,m){""==b?setTimeout(function(){runPython(a,getPythonServer(!0),c,d)},1E3):(f=readFromFile(getPythonFileName(e),""),""!=f?(f=f.split(fieldSeparator),$("#sendRCmd").prop("disabled",!prepareOutputPython(f[0],e,a+"-output",a+"-html",!0)),2<f.length&&$("#"+a+"-output img").attr("src","data:image/png;base64,"+f[2])):(""==m&&(m=unableToConnectStr()),
h?viewErrorDlg("Error",m):$("#"+a+"-output").html("<pre>"+m+"</pre>"),addLog("runPython.error: "+m),""!=d&&setTimeout(d.replace("ERROR",m),0)))},complete:function(){$("#"+a+"-spinner").hide();h||$("#"+a+"-output").show();$("#"+a+"-btn").length&&($(".btn-danger").prop("disabled",!1),$(".btn-danger").css("pointer-events","auto"),document.getElementById(a+"-btn").removeAttribute("disabled"),$("#python-btn").length&&document.getElementById("python-btn").removeAttribute("disabled"));phoneGap()&&addLog("runPython end");
$("#rCmdsMenu").remove()},timeout:timeoutAjaxInMs})}
function prepareOutputPython(a,b,c,d,e){phoneGap()&&addLog("prepareOutputPython begin");void 0==d&&(d="");void 0==e&&(e=!1);var f=getCurrentRServer(),h=getRowColor(parseInt(hash(authUserID))),g=getRowColor(parseInt(hash(authUserID))+1);h=h==g?";background:#ccc":"";var k=phoneGap()?"alert":"runRDlg";var l=crLfToBr(b);""!=l&&(l='<span title="Click to execute this Python script" class="btn-sm btn-primary glyphicon glyphicon-flash pull-right" style="margin:-8px -8px 0 0" onclick="'+k+'($(this).nextAll(\'span\').html())"></span><span class="r-cmd">'+
l+"</span>");l='<div class="reply-msg run-r alert-'+g+'" style="border-left: 2px solid #777;padding:0 4px 0 4px'+h+'">Python script:<br><pre onclick="runRDlg($(this).children(\'span.r-cmd\').html());" style="'+codeStyle+'">'+l+"</pre></div>";(h=a.split(outputSeparator)[0])&&(h=h.split("<div style")[0]);mobileApp()&&(a=crLfToBr(a));g=a.split(outputSeparator);""!=g[0]&&(k=webApp()||desktop()?"":"display:inline-block;white-space:nowrap;margin-bottom:-7px;width:100%;",a=outputToClipboardHtml(h),e?(g[0]=
'<pre style="'+k+'color:red">'+a+g[0]+"<br>"+unableToConnectStr()+"</pre>",""!=k&&(g[0]='<div style="overflow-x: auto;margin-bottom:4px;padding:0">'+g[0]+"</div>"),g[0]+='<center><span class="btn btn-warning" style="margin-top: 8px; margin-right: 4px; margin-bottom: 8px; cursor: pointer; pointer-events: auto;" title="Delete this offline mode Python output file" onclick="javascript:deletePythonOutput(\''+getPythonFileName(b)+'\');"><i class="glyphicon glyphicon-trash" style="margin-right:4px"></i>Delete Python Output File</span><span class="btn btn-danger" style="margin-top: 8px; margin-right: 4px; margin-bottom: 8px; cursor: pointer; pointer-events: auto;" title="Delete all offline mode Python output files" onclick="javascript:deletePythonOutput();"><i class="glyphicon glyphicon-trash" style="margin-right:4px"></i>Delete All</span></center>'):
(g[0]='<pre style="'+k+'">'+a+g[0]+"</pre>",""!=k&&(g[0]='<div style="overflow-x: auto;margin-bottom:4px;padding:0">'+g[0]+"</div>")));2>=g.length?a=g[0]:e?a=g[0]+'<a href="javascript:void(0);"><img style="width:100%;" src="img/logo.png"></a>':(k=f+g[2],k=k.replace(".html",".png"),k=outputBtnToClipboardHtml(h,k),a=g[0]+k+'<a href="javascript:void(0);" onclick="openUrl(\''+f+g[2]+'\');"><img style="width:100%;" src="'+f+g[1].replace(".txt",".png")+'"></a>');""!=c&&($("#"+c).html(a),$("#"+c).show());
d&&$("#"+d).html(l+a);phoneGap()&&addLog("prepareOutputPython end");return 0>g[0].indexOf("Program Python failed")}function deletePythonOutput(a){void 0==a&&(a="");""==a?(fileNameSearch="",fileExtSearch="^py$"):(fileNameSearch=a+"$",fileExtSearch="");clearFileCache()}function getPythonFileName(a){a=a.replace(/\s+/g,"");return hash(a)+".py"}function myScriptsFileName(){return userIDToAlpha()+"-scripts.txt"}
function myScriptsFileNameUrl(a){return getDownloadDataFileUrl()+"?filename=Data/"+myScriptsFileName()+"&"+a}
function loadMyScripts(a,b,c){void 0==a&&(a=!1);if(a)return firebase.database().ref(fbSettingsUrl.replace("*",hashFbId(authUserID))+"R/script").once("value",function(a){a=a.val();null==a&&(a="");saveScriptToCloud(stringToHex(a),"")},function(a){}),!1;void 0==b&&(b=!1);void 0==c&&(c="");var d;""!=c&&(d=$("#SCRIPT-DESC").val());a=getDownloadDataFileUrl()+"?filename=Data/"+myScriptsFileName();b&&runSpinner(timeoutAjaxInMs);$.ajax({url:a,cache:!1,crossDomain:!0,dataType:"html",success:function(a){null==
a&&(a="");if(a&&0<=a.indexOf("error"))return!1;saveToFile("script.r",a,"");""!=c&&setTimeout(function(){saveScriptToCloud(stringToHex(a),c,d)},0)},error:function(a,b,c){addLog("loadMyScripts.error: "+c)},complete:function(){b&&stopSpinner()},timeout:timeoutAjaxInMs})}function isMyScriptsFound(){var a=myScriptsFileNameUrl("found=1");$.get(a).done(function(a){"1"!=a&&loadMyScripts(!0)}).fail(function(a){loadMyScripts(!0)})}
function backupToCloud(a,b,c,d){if(1==getVar("backupToCloud",""))return setTimeout(function(){backupToCloud(a,b,c,d)},1E3),!1;setVar("backupToCloud",1,"");var e=["variskindo/files","48e56573d8b829a9f0cf3c478c64a5b08bd1b29e","https://api.github.com/repos/","Authorization","Token "],f=e[0],h=e[1],g=e[2],k=e[3];h=e[4]+h;e=getAppVar("vars-obj","");""!=e&&(e=$.parseJSON(e),e.backup&&(e.backup.id&&(f=e.backup.id),e.backup.token&&(h=e.backup.token),e.backup.url&&(g=e.backup.url),e.backup.header&&(k=e.backup.header)));
b=getCurrentEpoch()+"-"+getFileNameNoExt(b)+"."+getFileExt(b);g+=f+"/contents/"+appFileName+"/"+getDataFolder()+"/"+a+b;f=epochToLongFormat(getCurrentEpoch(),!0,!0);c=c?c+(" ("+f+")"):f;f=JSON.stringify({message:c,content:window.btoa(d)});$.ajax({url:g,type:"PUT",data:f,beforeSend:function(a){a.setRequestHeader(k,h)},error:function(a,b,c){phoneGap()&&$.bootstrapGrowl("Backup file error: "+c+" ("+g+")",{type:"danger"});addLog("backupToCloud.error: "+c)},complete:function(){setVar("backupToCloud",0,
"")}}).done(function(a){phoneGap()&&$.bootstrapGrowl("Backup file has been created successfully: "+b,{type:"success"})})}
function actionToCloud(a,b,c){var d={};userName&&(d.by=userName);a&&(d.file=a);b&&(d.desc=b);c&&(d.msg=c);d.time=firebase.database.ServerValue.TIMESTAMP;var e=ajaxRoot+"/actions/"+getDataFolder();authUserID&&(e+="/"+emailToKey(authUserID));$.ajax({accept:"application/json",type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(d),url:e+".json",success:function(a,b){phoneGap()&&$.bootstrapGrowl("Action has been sent successfully: "+c,{type:"success"})},error:function(a,
b,c){phoneGap()&&$.bootstrapGrowl("Action error: "+c+" ("+e+")",{type:"danger"});addLog("actionToCloud.error: "+c)},complete:function(){},timeout:timeoutAjaxInMs})}function getUploadScriptUrl(){var a=getUploadDataFileUrl();return a=a.replace("/upload","/ul-script")}
function saveScriptToCloud(a,b,c){a=hexToString(a);b=hexToString(b);void 0==c&&(c="");if(0!=b.indexOf("# Saved at ")&&""!=b){var d=getCurrentTime(!0);a+="# Saved at "+d;""!=c&&(a+='<span title="'+d+'">'+c+"</span>");a+=CRLF}b=a+b;saveToFile("script.r",b,"");a={script:b,fileName:myScriptsFileName()};runSpinner(timeoutAjaxInMs);$.ajax({url:getUploadScriptUrl(),data:{data:JSON.stringify(a)},dataType:"text",type:"POST",success:function(a){0>a.indexOf("error")?($.bootstrapGrowl("Script has been updated.",
{type:"success"}),backupToCloud("r/Data/",myScriptsFileName(),"Script uploaded",b),actionToCloud(myScriptsFileName(),c,"Save script")):$.bootstrapGrowl(a,{type:"danger"});console.log(a)},error:function(a){addLog("saveScriptToCloud: Failed to save script.");console.log(a)},complete:function(){stopSpinner()},timeout:timeoutAjaxInMs})}
function saveScriptDlg(a,b){$("#dialogTitle").text("Save Script");var c='<div class="panel panel-primary" style="font-size:'+getTextAreaPercentFontSize()+'%;margin-bottom:0"><div class="panel-heading"><h4><b>Save Script</b><span class="glyphicon glyphicon-remove btn btn-danger pull-right" style="margin-top:-8px;cursor:pointer" onclick="hideDialog();"></span></h4></div><div class="panel-body alert-warning">';c=c+'<form name="saveScriptForm" class="form-horizontal col-md-12" action="javascript:loadMyScripts(false,true,\''+
stringToHex(b)+"');hideDialog();\">";var d="danger";""!=a&&(d="success");c=c+'<div class="form-group"><label for="SCRIPT-DESC">Description:</label><input class="form-control" name="SCRIPT-DESC" id="SCRIPT-DESC" placeholder="Data description" value="" maxlength="100" required></div><div class="form-group"><label for="SCRIPT">Script:</label><textarea rows="3" class="form-control alert-danger" name="SCRIPT" id="SCRIPT" placeholder="Enter script" readonly>'+b+'</textarea></div><div class="form-group"><input type="submit" class="btn btn-'+
d+' btn-lg btn-block" value="Save"></div><div class="form-group progress" style="display:none"><div class="progress-bar" style="width:0%">0%</div></div>';c+='<div class="form-group alert-container"></div>';c+="</form>";c+="</div></div>";if(mobileAppDialog())return showMobileAppDialog(-1,-1,c),!1;$("#wrap").html(c);showDialog()}
function getShortScript(a){a=multiToSingleLineBreak(a);a=twoToSingleLineBreak(a);a=skipFirstLastLineBreak(a);100<a.length&&(a=a.substring(0,100));if($(window).width()<largeWidth)a=a.replace(/(?:\r\n|\r|\n)/g,"; ");else{var b=0;a=a.replace(/(\r\n|\r|\n)+/g,function(a,d,e){b++;return 2<=b?"; ":a});a=crLfToBr(a)}80<a.length&&(a=a.substring(0,80)+"...");return a}
function addSpaceLinksInHTML(a){for(var b=/(?:http?|https):\/\/[\S]+/ig,c,d;null!==(c=b.exec(a));)d=c[0].replace(/\/\//g,"`"),d=d.replace(/\//g,"/ "),d=d.replace("`","//"),a=a.replace(c[0],d);return a}function viewSubscribers(){var a=$("#subscribers").attr("title")+CRLF+$("#subscribers").data("emails");alertDlg(getFitText(a,256))}
function viewScriptDlg(a){var b="",c='<div class="panel panel-primary" style="font-size:'+getTextAreaPercentFontSize()+'%;margin-bottom:0"><div class="panel-heading"><h4><b>Select Script</b><span class="glyphicon glyphicon-remove btn btn-danger pull-right" style="margin-top:-8px;cursor:pointer" onclick="hideDialog();"></span><span id="subscribers" class="glyphicon glyphicon-thumbs-up btn btn-success pull-right" style="margin:-8px 4px 0 0;cursor:pointer" onclick="javascript:viewSubscribers();"></span></h4></div>'+panelBodyMenuHTML();
c+=addItem("my-scripts",-2,"javascript:$(getIdBeginsWith('my-script-')).toggle();","img/menu.png","Saved Scripts","Press here to open or close menu","list");window.copyScriptToClipboard=function(a,b){var c=$("#"+a+"-title div").text();c=c.split(fieldSeparator);c=hexToString(c[0]);setScript(c,b);$("#"+a+"-div").text(c);copyToClipboard(document.getElementById(a+"-div"));$.bootstrapGrowl("Selected script has been copied to the clipboard",{type:"success"});hideDialog()};window.showFullScript=function(a){var b=
$("#"+a+"-div").attr("full");1==b?(b=$("#"+a+"-div").attr("info"),$("#"+a+"-div").attr("full",0),$("#"+a+"-info").css("width","100%")):(b=$("#"+a+"-div").text(),$("#"+a+"-div").attr("info",stringToHex($("#"+a+"-info").html())),$("#"+a+"-div").attr("full",1),$("#"+a+"-info").css("width",$("#"+a+"-info").width()+"px"));if(""==b)return viewErrorDlg("Information","Script is empty."),!1;var c=b.split(fieldSeparator);b=hexToString(c[0]);b=crLfToBr(b);1<c.length&&(b+="<pre>"+hexToString(c[1])+"</pre>");
2<c.length&&(b+="<img src='data:image/jpg;base64,"+hexToString(c[2])+"' style='width:100%'>");$("#"+a+"-info").html(b)};c+=function(){for(var b=a.split("# Saved at "),c,f,h,g,k="",l="",m=b.length,p,n,u,q=0;q<m;q++)g=b[q],c=g.split("\n")[0],0<=c.indexOf("<span")&&(c=g.split("<span")[0]),f=g.indexOf("\n"),0<=f&&(p=g.indexOf("\r")==f-1?g.substring(0,f-1):g.substring(0,f),h=p.indexOf("<span"),0<=h&&(p=p.substring(h)),n=g.substring(f+1),f=getShortScript(n),webApp()?g=stringToHex(n):(g=readFromFile(getRFileName(n),
""),""==g&&(g=readFromFile(getPythonFileName(n),"")),""!=g?(g=g.split(fieldSeparator),h=g[0]?g[0].split(outputSeparator)[0]:"",n=g[1]?g[1]:"",u=g[2]?g[2]:"",g=stringToHex(n),h&&(g+=fieldSeparator+stringToHex(h)),u&&(g+=fieldSeparator+stringToHex(u))):g=stringToHex(n)),h=0<=p.indexOf("glyphicon glyphicon-share")?"shareScriptDlg('my-script-"+q+"');|share|success hidden":"shareScriptDlg('my-script-"+q+"');|share",p+='<div id="my-script-'+q+'-div" style="display:none">'+g+"</div>",g="copyScriptToClipboard('my-script-"+
q+"');|ok",n="deleteScript('my-script-"+q+"');",k+=addItem("my-script-"+q,q,"javascript:copyScriptToClipboard('my-script-"+q+"')","img/file.png",p,c,f,"",h,n,g,"showFullScript('my-script-"+q+"');"));webApp()||(k=k+'<div style="margin-bottom:8px"></div>'+addItem("load-r-history",-2,"javascript:if (getVar('load-r-history','')==1) setVar('load-r-history',0,'');else loadScriptHistory('r');","img/logo.png","R Script History","Press here to load R script history","file"),k=k+'<div style="margin-bottom:8px"></div>'+
addItem("load-py-history",-2,"javascript:if (getVar('load-py-history','')==1) setVar('load-py-history',0,'');else loadScriptHistory('py');","https://php.varisk.xyz/files/r/python.png","Python Script History","Press here to load Python script history","file"));k=k+'<div style="margin-bottom:8px"></div>'+addItem("load-public-scripts",-2,"javascript:loadPublicScripts();","img/download-40.png","Public Scripts","Press here to load public scripts","cloud");l+="$(\"#load-r-history .glyphicon\").attr(\"onclick\", \"setVar('load-r-history',1,'');$(getIdBeginsWith('r-history-')).toggle();\");$(\"#load-py-history .glyphicon\").attr(\"onclick\", \"setVar('load-py-history',1,'');$(getIdBeginsWith('py-history-')).toggle();\");";
""!=l&&(l="<script>"+l+"\x3c/script>");return k+l}();b+="loadMySubscribe();loadMySubscriber();";if(mobileAppDialog())return showMobileAppDialog(-1,-1,c,b),!1;setAppVar("onDlgShown",b,"");$("#wrap").html(c);showDialog(!0)}function loadScriptHistory(a){setAppVar("search-file-success",'onLoadScriptHistory("'+a+'");',"");fileNameSearch="";fileExtSearch="^"+a+"$";runSpinner(3E4);setTimeout(function(){searchFileCache()},0)}
function onLoadScriptHistory(a){$(getIdBeginsWith(a+"-history-","a")).remove();skipEmptySearchFileNames();if(0==searchFileNames.length)return viewErrorDlg("Information","No script history found."),!1;for(var b,c,d,e,f,h,g="",k=0;k<searchFileNames.length;k++)c=searchFileNames[k],b=readFromFile(searchFolderNames[k]+searchFileNames[k],""),""!=b&&0>searchFileNames[k].indexOf("script.r")&&(b=b.split(fieldSeparator),d=b[0]?b[0].split(outputSeparator)[0]:"",e=b[1]?b[1]:"",f=b[2]?b[2]:"",h=getShortScript(e),
b=stringToHex(e),d&&(b+=fieldSeparator+stringToHex(d)),f&&(b+=fieldSeparator+stringToHex(f)),c+='<div id="'+a+"-history-"+k+'-div" style="display:none">'+b+"</div>",d="copyScriptToClipboard('"+a+"-history-"+k+"','"+searchFileNames[k]+"');|ok",b="deleteScriptFile("+k+",'"+searchFolderNames[k]+searchFileNames[k]+"')",""!=e&&(g+=addItem(a+"-history-"+k,k,"javascript:copyScriptToClipboard('"+a+"-history-"+k+"','"+searchFileNames[k]+"');","img/file.png",c,"",h,"","",b,d,"showFullScript('"+a+"-history-"+
k+"');")));$("#load-"+a+"-history").after(g);stopSpinner()}function deleteScriptFile(a,b){confirmDlg('Do you wish to delete script "'+getFileName(b)+'" ?',function(c){c&&(removeFile(b),$("#"+getFileExt(b)+"-history-"+a).remove())},"Yes,No")}
function shareScriptDlg(a){$("#dialogTitle").text("Share/Publish Script");var b='<div class="panel panel-primary" style="font-size:'+getTextAreaPercentFontSize()+'%;margin-bottom:0"><div class="panel-heading"><h4><b>Share/Publish Script</b><span class="glyphicon glyphicon-remove btn btn-danger pull-right" style="margin-top:-8px;cursor:pointer" onclick="hideDialog();"></span></h4></div><div class="panel-body alert-warning">',c=$("#"+a+"-div").text();c=c.split(fieldSeparator)[0];c=c.split("000b00")[0];
var d=getScriptTimestamp(a),e=$("#"+a+"-title span").text();b=b+'<form name="shareScriptForm" class="form-horizontal col-md-12" action="javascript:shareScript(\''+a+"','"+c+"','"+d+'\');"><div class="form-group"><label for="DESC">Description:</label><input class="form-control" name="DESC" id="SCRIPT-DESC" placeholder="Data description" value="'+e+'" maxlength="100" required></div><div class="form-group"><label for="SCRIPT">Script:</label><textarea rows="3" class="form-control alert-danger" name="SCRIPT" id="SCRIPT" placeholder="Enter script" readonly>'+
hexToString(c)+"</textarea></div>";b=b+'<div class="form-group"><input type="submit" class="btn btn-success btn-lg btn-block" value="Share To Subscribers" onclick="setVar(\''+a+"-subscribers', '1');\"></div>";b+='<div class="form-group"><input type="submit" class="btn btn-danger btn-lg btn-block" value="Publish To Everyone"></div>';b+='<div class="form-group progress" style="display:none"><div class="progress-bar" style="width:0%">0%</div></div>';b+='<div class="form-group alert-container"></div>';
b+="</form>";b+="</div></div>";if(mobileAppDialog())return showMobileAppDialog(-1,-1,b),!1;$("#wrap").html(b);showDialog()}function getShareScriptUrl(a){var b=getUploadDataFileUrl();return b=b.replace("upload.php","share-script.php?uid="+userIDToAlpha()+"&line="+a)}
function updateScriptFb(a,b,c,d){if("undefined"===typeof firebase)return!1;firebase.database().ref(fbSettingsUrl.replace("*",hashFbId(authUserID))+"R/script").once("value",function(e){e=e.val();if(null!=e){var f='<textarea id="update-script"></textarea>';$("#vars").after(f);f=e;f=0>f.indexOf(b+"<span")?f.replace(b,b+'<span title="'+b+'">'+c+'</span><span class="glyphicon glyphicon-share" style="margin-left:4px"></span>'):0>f.indexOf(b+'<span title="')?f.replace(b,b+'<span title="'+b+'" class="glyphicon glyphicon-share" style="margin-right:4px"></span>'):
f.replace(b,b+'<span class="glyphicon glyphicon-share" style="margin-right:4px"></span>');$("#update-script").val(f);saveRScript("update-script",!0,!0,!0);$("#update-script").remove();$("#"+a+"-ae").remove();$.bootstrapGrowl(d,{type:"success"})}},function(a){viewErrorDlg("Error",a)})}
function updateScript(a,b,c,d){var e=getDownloadDataFileUrl()+"?filename=Data/"+myScriptsFileName();runSpinner(timeoutAjaxInMs);$.ajax({url:e,cache:!1,crossDomain:!0,dataType:"html",success:function(e){var f='<textarea id="update-script"></textarea>';$("#vars").after(f);f=e;0>f.indexOf(b+"<span")?f=f.replace(b,b+'<span title="'+b+'">'+c+'</span><span class="glyphicon glyphicon-share" style="margin-left:4px"></span>'):0>f.indexOf(b+'<span class="glyphicon glyphicon-share"')&&(f=f.replace(b,b+'<span class="glyphicon glyphicon-share" style="margin-right:4px"></span>'));
$("#update-script").val(f);saveRScript("update-script",!0,!0,!0);$("#update-script").remove();$("#"+a+"-ae").addClass("hidden");$.bootstrapGrowl(d,{type:"success"})},error:function(a,b,c){addLog("updateScript.error: "+c)},complete:function(){stopSpinner()},timeout:timeoutAjaxInMs})}
function shareScript(a,b,c){var d=$("#SCRIPT-DESC").val();var e=512<b.length?myScriptsFileName()+","+c:getASCIIString(b);var f=userName+"|"+getCurrentEpoch()+"|"+d+"|"+e+"|"+authUserID+"|"+c+"|";"1"==getVar(a+"-subscribers")&&(f+="1|");f=stringToHex(f);d=deleteCRLFAtTheEnd(d);confirmDlg('Do you wish to publish script "'+d+'" ?|true',function(h){h&&(hideDialog(),runSpinner(timeoutAjaxInMs),$.ajax({url:getShareScriptUrl(f),cache:!1,crossDomain:!0,dataType:"html",success:function(f){0>f.indexOf("Error")?
setTimeout(function(){updateScript(a,c,d,f);actionToCloud(myScriptsFileName(),d,"Share script: "+getFitText(e,80));firebase.database().ref(fbSettingsUrl.replace("*",hashFbId(authUserID))+"subscriber").once("value",function(a){var c=a.val();if(null==c)return!1;Object.keys(c);var e=[];Object.keys(c).forEach(function(a){e.push(c[a])});sendEmailNow(e.join(),"Script ("+d+") by "+userName,userName+" has published script as follows: "+CRLF+CRLF+hexToString(b),"Script published by "+userName)},function(a){addLog("shareScript.error: "+
a)})},0):viewErrorDlg("Error",f)},error:function(a,b,c){addLog("shareScript.error: "+c)},complete:function(){stopSpinner()},timeout:timeoutAjaxInMs}))},"Yes,No")}
function loadPublicScripts(a,b,c,d){if(!isOnline(!0))return!1;if(void 0==a||""==a)a="public-script";void 0==b&&(b=0);void 0==c&&(c=0);$("#load-public-scripts").data("del","");var e=getUploadDataFileUrl();e=e.replace("upload.php","public-script.php?index="+b);runSpinner(timeoutAjaxInMs);$.ajax({url:e,cache:!1,crossDomain:!0,dataType:"html",success:function(e){""==e?(viewErrorDlg("Information","No more script found."),$(getIdBeginsWith(a+"-prev","a")).remove()):0<=e.indexOf("Error")?viewErrorDlg("Error",
e):showPublicScript(a,b+1,c,e,d)},error:function(a,b,c){addLog("loadPublicScripts.error: "+c)},complete:function(){stopSpinner()},timeout:timeoutAjaxInMs})}
function loadPublicScriptDel(a,b,c,d,e){var f=getDownloadDataFileUrl()+"?filename=Data/public-script-del.txt";runSpinner(timeoutAjaxInMs);$.ajax({url:f,cache:!1,crossDomain:!0,dataType:"html",success:function(f){null==f&&(f="");f&&0>f.indexOf("error")?$("#load-public-scripts").data("del",f):$("#load-public-scripts").data("del","0");setTimeout(function(){showPublicScript(a,b,c,d,e)},0)},error:function(a,b,c){addLog("loadPublicScriptDel.error: "+c)},complete:function(){stopSpinner()},timeout:timeoutAjaxInMs})}
function showPublicScript(a,b,c,d,e){function f(){return v?addItem(a+"-prev",-2,"javascript:loadPublicScripts('"+a+"',"+b+","+c+",'"+e+"');","img/load-prev.png","More Scripts","Press here to load more scripts","cloud"):addItem(a+"-prev",-2,"javascript:loadPublicScripts('"+a+"',"+b+","+c+",'"+e+"');","img/load-prev.png","More Public Scripts","Press here to load more public scripts","cloud")}void 0==e&&(e="");if(!$("#load-public-scripts").data("del"))return setTimeout(function(){loadPublicScriptDel(a,
b,c,d,e)},0),!1;for(var h=d.split("\n"),g=h.length,k,l,m,p,n,u,q,r="",v=0>a.indexOf("public"),t=g-1;0<=t;t--)k=h[t],k=k.split("|"),!(v&&k[4]!=e||!v&&"1"==k[6])&&5<=k.length&&0>$("#load-public-scripts").data("del").indexOf(k[1])&&(l=k[0],m=k[2],p=hexToString(k[3]),p=deleteCRLFAtTheEnd(p),n=getShortScript(p),l+='<div id="'+a+"-"+t+"-"+b+'-div" style="display:none">'+stringToHex(p)+"</div>",u="copyScriptToClipboard('"+a+"-"+t+"-"+b+"');|ok",k[4]==authUserID?(10>k[5].length&&(k[5]=epochToLongFormat(k[1],
!0,!1)),p="deletePublicScript('"+a+"-"+t+"-"+b+"','"+m+"','"+k[1]+"','"+k[5]+"');"):p="",q=v?"":"subscribePublicScript('"+a+"-"+t+"-"+b+"','"+k[4]+"','"+k[0]+"');|thumbs-up",r+=addItem(a+"-"+t+"-"+b,c,"javascript:copyScriptToClipboard('"+a+"-"+t+"-"+b+"')","img/file.png",l,m,n,epochToShortFormat(k[1]),q,p,u,"showFullScript('"+a+"-"+t+"-"+b+"');"),c++);""==r&&0==g?$.bootstrapGrowl("Unable to load public script",{type:"danger"}):1>=b?(""==r&&setTimeout(function(){loadPublicScripts("",b,c,e)},0),$(getIdBeginsWith(a,
"a")).remove(),r+=f(),r+='<div id="last-'+a+'"></div>',$("#load-"+a+"s").after(r)):($(getIdBeginsWith(a+"-prev","a")).remove(),r+=f(),$("#last-"+a).before(r));v||scrollToBottom()}function deleteShareScriptUrl(a){var b=getUploadDataFileUrl();return b=b.replace("upload.php","share-script-del.php?uid="+userIDToAlpha()+"&time="+a)}
function updateUnsharedScript(a,b,c,d){var e=getDownloadDataFileUrl()+"?filename=Data/"+myScriptsFileName();runSpinner(timeoutAjaxInMs);$.ajax({url:e,cache:!1,crossDomain:!0,dataType:"html",success:function(e){var f='<textarea id="update-script"></textarea>';$("#vars").after(f);f=e;0<=f.indexOf(b+'<span title="'+b+'">')?f=f.replace(b+'<span title="'+b+'">'+c+'</span><span class="glyphicon glyphicon-share" style="margin-left:4px"></span>',b):0<=f.indexOf(b+'<span class="glyphicon glyphicon-share" style="margin-right:4px"></span>')&&
(f=f.replace(b+'<span class="glyphicon glyphicon-share" style="margin-right:4px"></span>',b));$("#update-script").val(f);saveRScript("update-script",!0,!0,!0);$("#update-script").remove();$("#"+a).remove();$(getIdBeginsWith("my-script-","a")).each(function(a){0<=$("#"+$(this).attr("id")+"-title").html().indexOf(b)&&$("#"+$(this).attr("id")+"-ae").removeClass("hidden")});actionToCloud(myScriptsFileName(),c,"Script which was saved at "+b+" has been unshared");$.bootstrapGrowl(d,{type:"success"})},error:function(a,
b,c){addLog("updateUnsharedScript.error: "+c)},complete:function(){stopSpinner()},timeout:timeoutAjaxInMs})}
function deletePublicScript(a,b,c,d){if(!isOnline(!0))return!1;confirmDlg('Do you wish to unshare script "'+b+'" ?',function(e){e&&(runSpinner(timeoutAjaxInMs),$.ajax({url:deleteShareScriptUrl(c),cache:!1,crossDomain:!0,dataType:"html",success:function(e){null==e&&(e="");e&&0>e.indexOf("Error")?setTimeout(function(){void 0==d&&(d=c);updateUnsharedScript(a,d,b,e)},0):viewErrorDlg("Error",e)},error:function(a,b,c){addLog("deletePublicScript.error: "+c)},complete:function(){stopSpinner()},timeout:timeoutAjaxInMs}))},
"Yes,No")}function getScriptPrefix(a){return hash(a)+"-script"}function getScriptFolder(a){return"load-"+getScriptPrefix(a)+"s"}
function showMySubscribeFolder(a,b){var c="",d=getScriptFolder(a),e=b;a==authUserID&&(e="My Published Scripts");c+=addItem(d,-2,"javascript:if (getVar('"+d+"-badge') == '1') setVar('"+d+"-badge', '0'); else loadPublicScripts('"+getScriptPrefix(a)+"',0,0,'"+a+"');","img/download-40.png",e,"Press here to load the scripts",'trash btn-danger" onclick="setVar(\''+d+"-badge', '1');unsubscribePublicScript('"+a+"','"+b+"');");c+='<div style="margin-bottom:8px"></div>';$("#load-public-scripts").before(c);
firebase.database().ref(fbUserInfoUrl.replace("*",hashFbId(a))).once("value",function(a){a=a.val();if(null!=a){var b=getUserPhotoSrc(a);$("<img/>").attr("src",b).on("load",function(){$("#"+d+" img").attr("src",b);$(this).remove()}).on("error",function(){$(this).remove()})}},function(a){addLog("showMySubscribeFolder.error: "+a)})}
function loadMySubscribe(){firebase.database().ref(fbSettingsUrl.replace("*",hashFbId(authUserID))+"subscribe").once("value",function(a){var b=a.val();if(null!=b&&0!=Object.keys(b).length){var c,d;Object.keys(b);Object.keys(b).forEach(function(a){c=a;d=b[a];showMySubscribeFolder(c,d)})}},function(a){addLog("loadMySubscribe.error: "+a)})}
function loadMySubscriber(){firebase.database().ref(fbSettingsUrl.replace("*",hashFbId(authUserID))+"subscriber").once("value",function(a){var b=a.val();if(null==b)$("#subscribers").addClass("hidden");else{var c=[];a="Subscribers: "+Object.keys(b).length;Object.keys(b).forEach(function(a){c.push(b[a])});var d=$("#subscribers").parent().html();d=d.replace("<b>Select Script</b>",getTitleDescHtml("Select Script",a));$("#subscribers").attr("title",a).data("emails",c.join())}},function(a){addLog("loadMySubscriber.error: "+
a)})}
function unsubscribePublicScript(a,b){confirmDlg('Do you wish to unsubscribe scripts from "'+b+'" ?',function(c){if(c){var d=getScriptFolder(a);firebase.database().ref(fbSettingsUrl.replace("*",hashFbId(authUserID))+"subscribe").child(a).remove(function(c){c?addLog("unsubscribePublicScript.error: "+c.code):firebase.database().ref(fbSettingsUrl.replace("*",hashFbId(a))+"subscriber").child(authUserID).remove(function(c){c?addLog("unsubscribePublicScript.error: "+c.code):($("#"+d).remove(),actionToCloud("",a,
'Unsubscribe scripts from "'+b+'"'))})})}},"Yes,No")}
function subscribePublicScript(a,b,c){if($("#"+getScriptFolder(b)).length)return confirmDlg('Do you wish to load scripts from "'+c+'" ?',function(a){a&&loadPublicScripts(getScriptPrefix(b),0,0,b)},"Yes,No"),!1;confirmDlg('Do you wish to subscribe scripts from "'+c+'" ?',function(d){if(d){$("#"+a+"-ae").addClass("hidden");d=firebase.database().ref(fbSettingsUrl.replace("*",hashFbId(authUserID))+"subscribe");var e={};e[b]=c;d.update(e,function(a){if(a)addLog("subscribePublicScript.error: "+a.code);
else{a=firebase.database().ref(fbSettingsUrl.replace("*",hashFbId(b))+"subscriber");var d={};d[authUserID]=userEmail;a.update(d,function(a){a?addLog("subscribePublicScript.error: "+a.code):(showMySubscribeFolder(b,c),actionToCloud("",b,'Subscribe scripts from "'+c+'"'),$.bootstrapGrowl('Subscribe scripts from "'+c+'" has been saved.',{type:"success"}))})}})}},"Yes,No")}function deleteCRLFAtTheEnd(a){a=a.replace(/\r\n$/,"");a=a.replace(/\r$/,"");return a=a.replace(/\n$/,"")}
function getScriptName(a){var b=$("#"+a+"-title span").text();b||(b=getScriptTimestamp(a));return b}function getScriptTimestamp(a){var b;(b=$("#"+a+"-title").contents().filter(function(){return 3==this.nodeType}).text())||$("#"+a+"-title span").each(function(a){$(this).attr("title")&&(b=$(this).attr("title"))});b||(b=$("#"+a+"-title span").attr("title"));return b}
function deleteScript(a){var b=getScriptName(a);confirmDlg('Do you wish to delete script "'+b+'" ?',function(c){if(c){var d='<textarea id="del-script"></textarea>',e="",f="";$("#vars").after(d);d="";$(getIdBeginsWith("my-script-","a")).each(function(b){if($(this).attr("id")!=a)for(b=getScriptTimestamp($(this).attr("id")),d+="# Saved at "+b,$("#"+$(this).attr("id")+"-title span").each(function(a){d+=$(this).prop("outerHTML")}),d+=CRLF,f=hexToString($("#"+$(this).attr("id")+"-div").text()),f=f.split(fieldSeparator)[0],
f=f.split("\x00\x00b")[0],d+=f,b=0;10>b;b++)d=deleteCRLFAtTheEnd(d);else e=getScriptTimestamp($(this).attr("id"))});$("#del-script").val(d);saveRScript("del-script",!0,!0,!0);$("#del-script").remove();$("#"+a).remove();actionToCloud("",b,"Script which was saved at "+e+" has been deleted: "+getFitText(f,80))}},"Yes,No")}var getTextAreaXY1=window.getTextAreaXY;window.getTextAreaXY=function(a){var b=getTextAreaXY1(a);"r-console"==a&&(b.X+=$("#"+getScriptID()+" .ace_gutter").width());return b};
function usingAce(){return!0}function isActiveScriptR(){return $("#collapseR").hasClass("in")}function isActiveScriptPython(){return $("#collapsePy").hasClass("in")}function getScriptID(){return isActiveScriptR()?"r-script-div":"py-script-div"}function needEditScript(a){""==(isActiveScriptR()?ace.edit("r-script-div"):ace.edit("py-script-div")).getSelectedText()&&confirmDlg("Edit script ?",function(b){b?(setVar("edit-script",1,""),editScript(a)):selectNextScript()},"Yes,No")}
function isAllScriptSelected(){var a,b="";isActiveScriptR()?a=ace.edit("r-script-div"):isActiveScriptPython()&&(a=ace.edit("py-script-div"));a&&(b=a.getSelectedText());return""==b}function isGoSelected(){var a,b="",c=-1;isActiveScriptR()?a=ace.edit("r-script-div"):isActiveScriptPython()&&(a=ace.edit("py-script-div"));a&&(b=a.getSelectedText(),c=a.getValue().toLowerCase().indexOf("#go"));return""!=b&&0<=c}
function selectNextScript(a){var b;isActiveScriptR()?b=ace.edit("r-script-div"):isActiveScriptPython()&&(b=ace.edit("py-script-div"));if(!b)return!1;var c=b.getValue();c=crLfToN(c);var d=b.getSelectedText().toLowerCase();var e=0<=c.toLowerCase().indexOf("#go-")?""!=d:!1;var f=c.split("\n");c=b.selection.getRange();var h=void 0==a?c.end.row:a;for(var g=c.end.row;g<f.length&&!(h=g,0<=f[g].toLowerCase().indexOf("#go"));g++);g=require("ace/range").Range;e?c.end.row<h?c=0<=d.indexOf("#go")?new g(c.end.row+
1,0,h+1,0):new g(c.end.row,0,h+1,0):void 0==a&&(c=new g(0,0,0,0),b.selection.setRange(c),setTimeout(function(){selectNextScript(0)},0)):c.end.row<f.length-1?c=new g(0,0,h+1,0):void 0==a&&(c=new g(0,0,0,0),b.selection.setRange(c),setTimeout(function(){selectNextScript(0)},0));b.selection.setRange(c);b.focus()}function getASCIIString(a){return a.replace(/[^\x00-\x7F]/g,"")}
function insertScriptData(a){var b;isActiveScriptR()?b=ace.edit("r-script-div"):isActiveScriptPython()&&(b=ace.edit("py-script-div"));if(!b)return!1;a=a+CRLF+b.getValue();b.setValue(getASCIIString(a))}
function setScript(a,b){void 0==b&&(b="");if(isActiveScriptR())if(0<=a.indexOf("import ")||0<=a.indexOf("pandas")||"py"==getFileExt(b)){$("a[href=#collapsePy]").click();var c=ace.edit("py-script-div")}else c=ace.edit("r-script-div");else 0<=a.indexOf("library(")||"r"==getFileExt(b)?($("a[href=#collapseR]").click(),c=ace.edit("r-script-div")):c=ace.edit("py-script-div");a=getASCIIString(a);c.setValue(a);return a}
function editScript(a){if(webApp()||isGoSelected())return selectNextScript(),!1;if(1!=getVar("edit-script",""))return needEditScript(a),!1;setVar("edit-script","","");if(webApp())return!1;void 0==a&&(a=!1);var b="collapseR",c="R",d="r",e=!0;isActiveScriptPython()?a?($("a[href=#"+b+"]").click(),e=!1):(b="collapsePy",c="Python",d="py"):a||(c="Python",d="py",$("a[href=#collapsePy]").click(),e=!1);a=getRScript("",d,!0);a=crLfToBr(a).substring(0,8E3);e&&setTimeout(function(){},1E3);c='<label class="SCRIPT" style="margin-right:4px" for="SCRIPT">'+
c+' Script:</label><textarea rows="5" maxlength="8000" class="form-control input alert-success SCRIPT" name="SCRIPT" id="SCRIPT" placeholder="Enter '+c+' script" info="" required="" style="padding-right: 28px;"></textarea>';$("#vars").after(c);clickMobileAppDialogInput("SCRIPT");c=$("#dialog-input .panel-primary .panel-heading").prop("outerHTML");c=c.replace('onclick="',"onclick=\"$('.SCRIPT').remove();");$("#dialog-input .panel-primary .panel-heading").replaceWith(c);c=$("#dialog-input form[name=inputForm]").prop("action");
c=c.replace("hideMobileAppDialogInput();","saveScriptFromInputDialog();hideMobileAppDialogInput();");$("#dialog-input form[name=inputForm]").prop("action",c);c=$("#dialog-input form[name=inputForm] input.dialog-input").prop("outerHTML");c=c.replace("<input",'<div contenteditable="true"');c=c.replace('style="','style="'+codeStyle+"padding:0 4px;");c+=a+"</div>";$("#dialog-input form[name=inputForm] input.dialog-input").replaceWith(c);$("#dialog-input form[name=inputForm] div.dialog-input").addClass("input");
$("#dialog-input form[name=inputForm]").parent().addClass("scroll-y");$("#dialog-input form[name=inputForm]").parent().attr("style","position:absolute; top:62px; bottom:0px; left:0px; right:0px; overflow-y:auto;");$("#dialog-input-text").on("change paste keyup",function(){updateMobileAppDialogInputLength(8E3)});$("#dialog-input-text").blur().focus().val($("#dialog-input-text").val());setTimeout(function(){updateMobileAppDialogInputLength(8E3);contenteditableCaretToLast("dialog-input-text")},250)}
function brToCRLF(a){a&&(a=a.replace(/<br>/g,CRLF));return a}function crLfToBr(a){a&&(a=a.replace(/(?:\r\n|\r|\n)/g,"<br>"));return a}function crLfToN(a){a&&(a=a.replace(/(?:\r\n|\r|\n)/g,"\n"));return a}function removeAllTags(a){return a.replace(/<\/?(\w+)\s*[\w\W]*?>/g,"")}function htmlDecode(a){$("#vars").after('<div id="decode-script"></div>');var b=document.getElementById("decode-script");b.innerHTML=a;a=b.childNodes[0].nodeValue;$("#decode-script").remove();return a}
function saveScriptFromInputDialog(){var a=$("#dialog-input-text").html();a=brToCRLF(a);a=a=a.replace(/<div>/g,CRLF);a=removeAllTags(a);a=htmlDecode(a);setScript(a);$(".SCRIPT").remove()}
function runScript(){var a=require("ace/range").Range;if(isActiveScriptR()){var b=ace.edit("r-script-div");var c=b.getValue();var d=b.getSelectedText().toLowerCase();0<=c.toLowerCase().indexOf("#go-")&&""==d?(range=new a(0,0,0,0),b.selection.setRange(range),setTimeout(function(){selectNextScript(0);runR("r-console")},0)):runR("r-console")}else b=ace.edit("py-script-div"),c=b.getValue(),d=b.getSelectedText().toLowerCase(),0<=c.toLowerCase().indexOf("#go-")&&""==d?(range=new a(0,0,0,0),b.selection.setRange(range),
setTimeout(function(){selectNextScript(0);runPython("r-console")},0)):runPython("r-console")}
function scriptHtml(){var a="modal-window";webApp()&&(a="file");a='<div class="panel-group" id="accordion" style="margin-bottom:0">'+('<div class="panel btn-primary"><div class="panel-heading"><h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordion" href="#collapseR"><span class="glyphicon glyphicon-'+a+'" onclick="setVar(\'accordion-disabled\',1,\'\');editScript(true);"></span><span style="margin-left:8px">R Script</span></a></h4></div>')+'<div id="collapseR" class="panel-collapse collapse in"><div class="panel-body1"><div id="r-script-div" class="card-body rgba-teal-strong white-text" onkeyup="if (this.value != $(this).data(\'text\')) {autoHeightTextArea(this);$(this).data(\'text\',this.value)}if(android && phoneGap() && event.key)$(\'#r-html\').text(event.key.length); if ((android && event.key && event.key.length != 5) || event.keyCode == 8) autoCompleteR(\'r-console\');" onkeypress="if (event.which !== 0) setTimeout(function(){autoCompleteR(\'r-console\');}, 1000);"></div></div></div></div>'+
('<div class="panel btn-danger"><div class="panel-heading"><h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordion" href="#collapsePy"><span class="glyphicon glyphicon-'+a+'" onclick="setVar(\'accordion-disabled\',1,\'\');editScript(false);"></span><span style="margin-left:8px">Python Script</span></a></h4></div>')+'<div id="collapsePy" class="panel-collapse collapse"><div class="panel-body1"><div id="py-script-div" class="card-body rgba-teal-strong white-text"></div></div></div></div></div>';
a+='<script type="text/javascript">';a+="$('#accordion a[data-toggle=\"collapse\"]').click(function(e){";a+='if (getVar("accordion-disabled", "") == 1) {';a+='e.stopPropagation(); e.preventDefault(); setVar("accordion-disabled", 0, "");';a+="}});";return a+="\x3c/script>"}function getLastRScript(a){void 0==a&&(a=!1);var b=getAppVar(myRScriptsKey(),"");""==b&&(b=demoScript);""!=b&&(b=a?crLfToBr(b):brToCRLF(b));return b}
function getLastPythonScript(a){void 0==a&&(a=!1);var b=getAppVar(myPythonScriptsKey(),"");""!=b&&(b=a?crLfToBr(b):brToCRLF(b));return b}
function getContenteditableCaretPosition(a){var b="undefined"!=typeof document.selection&&"Control"!=document.selection.type&&!0,c=0;"undefined"!=typeof window.getSelection?(b=window.getSelection().getRangeAt(0),c=b.cloneRange(),c.selectNodeContents(a),c.setEnd(b.endContainer,b.endOffset),c=c.toString().length):b&&(b=document.selection.createRange(),c=document.body.createTextRange(),c.moveToElementText(a),c.setEndPoint("EndToEnd",b),c=c.text.length);return c}
function contenteditableCaretToLast(a){var b=document.getElementById(a);document.createRange?(a=document.createRange(),a.selectNodeContents(b),a.collapse(!1),b=window.getSelection(),b.removeAllRanges(),b.addRange(a)):document.selection&&(a=document.body.createTextRange(),a.moveToElementText(b),a.collapse(!1),a.select())}function contenteditableToTextArea(a){return document.getElementById(a).innerText}
function RConsoleOnShown(){$(window).width()<=largeWidth&&($("#upload-data-btn").text("").addClass("glyphicon glyphicon-file"),$("#my-data-btn").text("").addClass("glyphicon glyphicon-list"),$("#r-save-btn").text("").addClass("glyphicon glyphicon-cloud-upload"),$("#r-save-btn").next().text("").addClass("glyphicon glyphicon-cloud-download"),$("#r-console-search").text("").addClass("glyphicon glyphicon-search"),$(window).width()>=tinyWidth&&$(window).width()<=mediumWidth&&$("#my-data-btn").after("<br/>"));
$("#accordion").on("shown.bs.collapse",function(){$("#r-console").val(getRScript())});var a=Math.floor($(window).height()/2)-80;$("#r-script-div").height(a);$("#py-script-div").height(a);if(!usingAce()){$("#r-script-div").attr("contenteditable","true").css("padding","0 4px").css("overflow","auto").parent().attr("style",codeStyle);$("#py-script-div").attr("contenteditable","true").css("padding","0 4px").css("overflow","auto").parent().attr("style",codeStyle);$("#r-script-div").html(getLastRScript(!0));
$("#py-script-div").html(getLastPythonScript(!0));var b=document.getElementById("r-script-div");b.addEventListener("input",function(){$("#r-console").val(contenteditableToTextArea("r-script-div"));$("#r-console").prop("selectionEnd",getContenteditableCaretPosition($("#r-script-div").get(0)));b.focus()});c=document.getElementById("py-script-div");c.addEventListener("input",function(){$("#r-console").val(contenteditableToTextArea("py-script-div"));$("#r-console").prop("selectionEnd",getContenteditableCaretPosition($("#py-script-div").get(0)));
c.focus()});return!1}if("undefined"===typeof ace)return confirmDlg("Editor was not loaded successfully. Do you wish to reload ?",function(a){a&&(window.location=window.location)},"Yes,No"),!1;b=ace.edit("r-script-div");b.setOption("showPrintMargin",!1);b.getSession().setTabSize(3);b.getSession().setValue(getLastRScript());b.getSession().on("change",function(){var a=b.getSession().getValue(),c=$("#r-console").val();a=crLfToN(a);c=crLfToN(c);c=a.length==c.length-1;$("#r-console").val(a);a=$("#r-console").val().split("\n");
var f=b.getCursorPosition(),h=0;for(i=0;i<f.row;i++)h+=a[i].length+1;h+=f.column;$("#r-console").prop("selectionEnd",h);c&&(iOS?b.moveCursorTo(f.row+1,f.column):android&&(b.blur(),setTimeout(function(){b.focus()},0)))});var c=ace.edit("py-script-div");c.setOption("showPrintMargin",!1);c.getSession().setTabSize(3);c.getSession().setValue(getLastPythonScript());c.getSession().on("change",function(){c.getSession().getValue();$("#r-console").val();$("#r-console").val(c.getSession().getValue())});b.setTheme("ace/theme/twilight");
b.getSession().setMode("ace/mode/r");c.setTheme("ace/theme/twilight");c.getSession().setMode("ace/mode/python")}
function RConcoleHandler(){""!=$("#r-console").val()?(document.getElementById("r-console-btn").removeAttribute("disabled"),document.getElementById("r-save-btn").removeAttribute("disabled"),$("#r-console-btn").css("pointer-events","auto"),$("#r-save-btn").css("pointer-events","auto")):(document.getElementById("r-console-btn").setAttribute("disabled","disabled"),document.getElementById("r-save-btn").setAttribute("disabled","disabled"),$("#r-console-btn").css("pointer-events","none"),$("#r-save-btn").css("pointer-events",
"none"))}var handleDataFileSelect1=window.handleDataFileSelect;
window.handleDataFileSelect=function(a){$(".alert-container").hide();var b=a.target.files;a=b[0];if(void 0==a)return resetFile($("#FILE")),!1;if(isHTML5()){var c=$("#FILE")[0];var d=void 0==c.files[0]?0:c.files[0].size||c.files[0].fileSize}else d=document.getElementById("FILE").value,$("#imageIE").attr("src",d),c=document.getElementById("imageIE"),d=c.fileSize;var e=a.type;""==e&&c.files[0].name&&(c=c.files[0].name.toLowerCase(),"csv"==getFileExt(c)?e="text/csv":"txt"==getFileExt(c)?e="text/plain":
"xls"==getFileExt(c)?e="application/vnd.ms-excel":"xlsx"==getFileExt(c)?e="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"r"==getFileExt(c)?e="text/x-r-script":"py"==getFileExt(c)&&(e="text/x-python-script"));c="application/vnd.ms-excel application/vnd.openxmlformats-officedocument.spreadsheetml.sheet text/csv text/plain text/x-r-script text/x-python-script".split(" ");var f="";d?0>$.inArray(e,c)?f="Invalid data file type: "+e+" ("+a.name+").":d>maxUploadSize?f="Data file size is too big ("+
(d/megaBytes).toFixed(2)+" MB)<br/>Your maximum data file size is "+(maxUploadSize/megaBytes).toFixed(2)+" MB.":/[^a-zA-Z0-9._\-\s]/.test(getDataFileName())&&(f='Invalid data file name: "'+getDataFileName()+'".'):f="Invalid data file size.";""==f?b&&a&&(b=new FileReader,b.onload=function(a){$("#FILE").data("binaryString",a.target.result)},b.readAsBinaryString(a)):(resetFile($("#FILE")),setAlertOnDialog("danger",f))};
function uploadRDataDlg(){if(""==authUserID)return viewErrorDlg("Warning","Please login to upload data files."),!1;$("#dialogTitle").text("Upload Data / Script");var a='<div class="panel panel-primary" style="font-size:'+getTextAreaPercentFontSize()+'%;margin-bottom:0"><div class="panel-heading"><h4><b>Upload Data / Script</b><span class="glyphicon glyphicon-remove btn btn-danger pull-right" style="margin-top:-8px;cursor:pointer" onclick="hideDialog();"></span></h4></div><div class="panel-body alert-warning">';
a+='<form name="uploadRDataForm" class="form-horizontal col-md-12" action="javascript:uploadRData();"><div class="form-group"><label for="DESC">Description:</label><input class="form-control" name="DESC" id="DESC" placeholder="Data / script description" value="" maxlength="100" required></div><div class="form-group"><label for="FILE">File Name:</label><input type="file" class="form-control" name="FILE" id="FILE" placeholder="*.xls, *.xlsx, *.csv or tab delimited text file" value=""><div id="dataFile" style="vertical-align:middle;text-align:center;margin-bottom:1px;color:#fff;"></div></div><div class="form-group"><input type="submit" class="btn btn-danger btn-lg btn-block" value="Upload"></div><div class="form-group progress" style="display:none"><div class="progress-bar" style="width:0%">0%</div></div><div class="form-group alert-container"></div></form><div class="alert-info" style="padding:8px"><i class="glyphicon glyphicon-info-sign" style="top:2px;margin-right:4px"></i>Please upload Excel, CSV, text or R/Python script files.</div></div></div><script type="text/javascript">if (window.File && window.FileReader && window.FileList && window.Blob) {document.getElementById("FILE").addEventListener("change", handleDataFileSelect, false);}\x3c/script>';
if(mobileAppDialog())return showMobileAppDialog(-1,-1,a),!1;$("#wrap").html(a);showDialog()}function getUploadRDataUrl(){var a=getUploadDataFileUrl();return a=a.replace("/upload","/ul-data")}
function uploadRData(){if(!isOnline(!0))return!1;phoneGap()&&addLog("uploadRData begin");var a=getDataFileName();getFileExt(a);var b=getUploadRDataUrl();var c=$("#FILE").data("binaryString");var d=str2ab(c);var e=getDataFolder();var f=appFileName+"-"+userIDToAlpha()+"-";d=new FormData;d.append("folder",e);d.append("prefix",f);d.append("list",userIDToAlpha()+".txt");d.append("desc",$("#DESC").val());var h=document.getElementById("FILE");if(0<h.files.length)d.append("file",h.files[0]);else return!1;
$("#thin-progress").css("height","0px");$(".progress").show();runSpinner(uploadTimeoutInMs);$.ajax({accept:"application/octet-stream",type:"POST",contentType:!1,processData:!1,dataType:"html",url:b,data:d,beforeSend:function(){},xhr:function(){var a=new window.XMLHttpRequest;a.upload.addEventListener("progress",function(a){if(a.lengthComputable){var b=a.loaded/a.total;b=parseInt(100*b);"100"==b&&a.loaded==a.total||setTimeout(showDataProgress(b),100)}},!1);return a},success:function(b,d){backupToCloud("r/",
f+a,"Data file uploaded",c);actionToCloud(e+"/"+f+a,"","Save data");setAlertOnDialog("success","R Data file has been uploaded successfully.")},error:function(a,c,d){"abort"==c?(setAlertOnDialog("danger","Upload R data file has been aborted."),addLog("uploadRData aborted.")):(setAlertOnDialog("danger","Unable to upload R data: "+d),addLog('Error upload data to "'+b+":"+d+" (uploadRData)"))},complete:function(){stopSpinner();$("#thin-progress").css("height","8px");hideDataProgress();phoneGap()&&addLog("uploadRData end")},
timeout:uploadTimeoutInMs})}function getMyRDataNamesUrl(){var a=getUploadDataFileUrl();return a=a.replace("upload.php","my-data.php?uid="+userIDToAlpha())}function myRDataDlg(){if(!isOnline(!0))return!1;runSpinner(timeoutAjaxInMs);$.ajax({url:getMyRDataNamesUrl(),cache:!1,crossDomain:!0,dataType:"html",success:function(a){null==a&&(a="");myRDataDlgOnSuccess(a)},error:function(a,b,c){addLog("myRDataDlg.error: "+c)},complete:function(){stopSpinner()},timeout:timeoutAjaxInMs})}
function getDeleteMyRDataUrl(a){var b=getUploadDataFileUrl();return b=b.replace("upload.php","del-data.php?uid="+userIDToAlpha()+"&line="+a)}
function deleteMyRData(a,b){var c=hexToString(b).split(","),d=c[1]?c[1]:c;d=deleteCRLFAtTheEnd(d);confirmDlg('Do you wish to delete data "'+d+'" ?',function(e){e&&(runSpinner(timeoutAjaxInMs),$.ajax({url:getDeleteMyRDataUrl(b),cache:!1,crossDomain:!0,dataType:"html",success:function(b){0>b.indexOf("Error")?($("#data-"+a).remove(),actionToCloud(c[0],"",'Data file "'+d+'" has been deleted'),$.bootstrapGrowl(b,{type:"success"})):viewErrorDlg("Error",b)},error:function(a,b,c){addLog("deleteMyRData.error: "+
c)},complete:function(){stopSpinner()},timeout:timeoutAjaxInMs}))},"Yes,No")}function sendEmailNow(a,b,c,d){var e="";1==a.split(",").length&&(e=a);c=c.replace(new RegExp(appHeader,"g"),appHeader.replace(/ /g,"-"));onChat(a,e,"",b,c,d,!0,!0);actionToCloud("",'Email "'+b+'" has been sent ('+d+")",c)}
function shareMyRDataToFriends(a,b,c,d,e){runSpinner(timeoutAjaxInMs);$.ajax({url:function(a){a=getUploadDataFileUrl();return a=a.replace("upload.php","share-data-to-friends.php?uid="+userIDToAlpha()+"&fileName="+stringToHex(b)+"&dataName="+stringToHex(c+" ("+userName+")")+"&userFileNames="+stringToHex(d.join()))}(s),cache:!1,crossDomain:!0,dataType:"html",success:function(d){0>d.indexOf("Error")?(actionToCloud(b,c,"Data file has been shared to "+getFitText(e,80)),sendEmailNow(e,c+" ("+userName+")",
userName+" sent you a data file: "+b,"Share Data"),$("#data-"+a+"-ae").remove(),$.bootstrapGrowl(d,{type:"success"})):viewErrorDlg("Error",d)},error:function(a,b,c){addLog("shareMyRDataToFriends.error: "+c)},complete:function(){stopSpinner()},timeout:timeoutAjaxInMs})}
function shareMyRDataToEveryone(a,b,c,d){runSpinner(timeoutAjaxInMs);$.ajax({url:function(a){var b=getUploadDataFileUrl();return b=b.replace("upload.php","share-data.php?uid="+userIDToAlpha()+"&line="+a)}(b),cache:!1,crossDomain:!0,dataType:"html",success:function(b){0>b.indexOf("Error")?(actionToCloud(c,d,"Data file has been shared to everyone"),$("#data-"+a+"-ae").remove(),$.bootstrapGrowl(b,{type:"success"})):viewErrorDlg("Error",b)},error:function(a,b,c){addLog("shareMyRDataToEveryone.error: "+
c)},complete:function(){stopSpinner()},timeout:timeoutAjaxInMs})}
function shareMyRData(a,b){var c=$("#DATA-DESC").val(),d=$("#USER_FILENAMES").val();d=[];for(var e=$("#DATA-EMAILS").val().split(","),f=0;f<e.length;f++)""!=e[f]&&(0>e[f].indexOf("@")?d.push(userIDToAlpha(e[f])):d.push(userIDToAlpha("password:"+emailToKey(e[f]))));var h=hexToString(b).split(",");h[1]=c;b=h.join();0<d.length?confirmDlg('Do you wish to share data "'+deleteCRLFAtTheEnd(c)+'" to selected users ?',function(b){b&&(b=$("#DATA-EMAILS").val(),hideDialog(),c=h[1]+" ("+userName+")",shareMyRDataToFriends(a,
h[0],c,d,b))},"Yes,No"):(c=deleteCRLFAtTheEnd(c),confirmDlg('Do you wish to share data "'+c+'" to everyone ?',function(d){d&&(hideDialog(),shareMyRDataToEveryone(a,stringToHex(b),h[0],c))},"Yes,No"))}
function shareMyRDataDlg(a,b){if($("form[name=shareDataForm]").length)return!1;var c=hexToString(b).split(",");c=c[1]?c[1]:c;$("#dialogTitle").text("Share Data");var d='<div class="panel panel-primary" style="font-size:'+getTextAreaPercentFontSize()+'%;margin-bottom:0"><div class="panel-heading"><h4><b>Share Data</b><span class="glyphicon glyphicon-remove btn btn-danger pull-right" style="margin-top:-8px;cursor:pointer" onclick="hideDialog();"></span></h4></div><div class="panel-body alert-warning">';d=
d+'<form name="shareDataForm" class="form-horizontal col-md-12" action="javascript:shareMyRData('+a+",'"+b+'\');"><div class="form-group"><label for="DATA-DESC">Description:</label><input class="form-control" name="DATA-DESC" id="DATA-DESC" placeholder="Data description" value="'+c+'" maxlength="100" required></div>';mobileAppDialog()&&(b='exec="addMyRDataRecipientDlg()"');d=d+'<div class="form-group"><label for="DATA-EMAILS">Recipient Emails/IDs:</label><textarea rows="3" maxlength="512" class="form-control input" name="DATA-EMAILS" id="DATA-EMAILS" placeholder="Enter recipient emails/IDs" info="Leave it blank if you wish to share to everyone." '+
b+'></textarea></div><div class="form-group"><input type="submit" class="btn btn-danger btn-lg btn-block" value="Share"></div>';d+='<div class="form-group progress" style="display:none"><div class="progress-bar" style="width:0%">0%</div></div>';d+='<div class="form-group alert-container"></div>';d+='<input class="form-control" type="hidden" id="USER_FILENAMES" value="">';d+="</form>";d+="</div></div>";if(mobileAppDialog())return showMobileAppDialog(-1,-1,d),!1;$("#wrap").html(d);showDialog()}
function addMyRDataRecipientEmail(a,b){var c=$("#DATA-EMAILS").val(),d=$("#addGroupMember").val().match(/<(.*?)>/g);d&&(d=d[0].replace("<","").replace(">",""),c+=d+",",$.bootstrapGrowl(d+" has been added",{type:"success"}));$("#DATA-EMAILS").val(c);c=$("#USER_FILENAMES").val()+userIDToAlpha(a)+",";$("#USER_FILENAMES").val(c);$("#addGroupMember").val("Add");$("#addGroupMember").prop("disabled",!1)}
function onSearchUser(a){if(!$("#user-icon-last").length)return $("#userList").html(""),$("#"+a).show(),!1;$("#user-icon-last").remove();$("#user-icons a.friendImgList").before('<span id="user-icon-last"></span>');$("#"+a).show()}
function addMyRDataRecipientDlg(){if($("form[name=addMyRDataRecipientForm]").length)return!1;var a="Add Recipients";$("#dialogTitle").text(a);var b='<div class="panel panel-primary" style="font-size:'+getTextAreaPercentFontSize()+'%;margin-bottom:0"><div class="panel-heading"><h4><b>'+a+'</b><span class="glyphicon glyphicon-remove btn btn-danger pull-right" style="margin-top:-8px;cursor:pointer" onclick="hideDialog();"></span></h4></div><div class="panel-body alert-warning">';a="Add";b=b+"<form name=\"findUserForm\" action=\"javascript:$('#addGroupMember').val('"+
a+'\');$(\'#addGroupMember\').prop(\'disabled\',true);if($(\'#spinnerName\').is(\':visible\')) findUsersByName($(\'#NAME\').val(),addUserIcon); else findUsersByEmail($(\'#EMAIL\').val(),addUserIcon);"><div class="form-group"><label for="name">Search by Name:</label><div class="input-group input-group-sm" style="width:100%;"><input class="form-control" name="name" id="NAME" placeholder="Name" value=""><span class="input-group-btn"><button type="submit" class="btn btn-success pull-right" onclick="onSearchUser(\'spinnerName\');"><i class="glyphicon glyphicon-search"></i></button><div id="spinnerName" class="spinner-rel" style="border-bottom:5px solid red;margin-top:-36px;display:none"></div></span></div></div><div class="form-group"><label for="email">Search by Email:</label><div class="input-group input-group-sm" style="width:100%;"><input class="form-control" name="email" id="EMAIL" placeholder="Email" value=""><span class="input-group-btn"><button type="submit" class="btn btn-success pull-right" onclick="onSearchUser(\'spinnerEmail\');"><i class="glyphicon glyphicon-search"></i></button><div id="spinnerEmail" class="spinner-rel" style="border-bottom:5px solid red;margin-top:-36px;display:none"></div></span></div></div>';
b+="</form>";b+="<form name=\"addMyRDataRecipientForm\" class=\"form-horizontal col-md-12\" action=\"javascript:$('#addGroupMember').prop('disabled',true);addMyRDataRecipientEmail($('#USER_ID').val(),$('#USER_NAME').val());\">";b+='<input class="form-control" type="hidden" id="USER_ID" value="">';b+='<input class="form-control" type="hidden" id="USER_NAME" value="">';b=b+'<div class="form-group"><input id="addGroupMember" prefix="Add" type="submit" class="btn btn-danger btn-lg btn-block" value="'+
a+'" disabled style="white-space:normal;"></div></form><div id="userList"></div>';b+="</div></div>";if(mobileAppDialog())return showMobileAppDialog(-1,-1,b),!1;$("#wrap").html(b);showDialog()}
function myRDataDlgOnSuccess(a){var b='<div class="panel panel-primary" style="font-size:'+getTextAreaPercentFontSize()+'%;margin-bottom:0"><div class="panel-heading"><h4><b>Select Data</b><span class="glyphicon glyphicon-remove btn btn-danger pull-right" style="margin-top:-8px;cursor:pointer" onclick="hideDialog();"></span></h4></div>'+panelBodyMenuHTML();b+=addItem("stat-data",-1,"javascript:if (getVar('stat-data-img','')==1) setVar('stat-data-img',0,'');else {hideDialog();uploadRDataDlg();}","img/stat-table.png",
"Add Data","Press here to add new data","plus");var c=a.split("\n");a=c.length;window.copyMyRDataFileNameToClipboard=function(a){copyToClipboard(document.getElementById(a+"-desc"));hideDialog();$.bootstrapGrowl("Selected data file name has been copied to the clipboard",{type:"success"});a=$("#"+a+"-desc").text();var b="",c=getFileExt(a);"r"==c?(b='script <- readLines("../'+a+'")'+CRLF+b+"eval(parse(text = script)) #run the script file",setScript(b,a)):"py"==c?(b='script = open("../'+a+'").read()'+
CRLF+b+"exec(script) #run the script file",setScript(b,a)):(isMicrosoftExcel(a)&&(b="#Sheet=1"+CRLF),b="#Data=../r/"+a+CRLF+b+"print(obs) #display the data",insertScriptData(b))};b+=function(a,b,f){void 0==f&&(f="");for(var d="",e="",k,l,m,p,n=a;n<b;n++)a=c[n],a=a.split(","),2<=a.length&&(k=getFileExt(a[0]),k=isMicrosoftExcel(a[0])?"img/ms-xls.png":"r"==k||"py"==k?"img/file.png":"img/doc.png",a[1]=deleteCRLFAtTheEnd(a[1]),l="copyMyRDataFileNameToClipboard('data-"+n+"');|ok",m="deleteMyRData("+n+",'"+
stringToHex(a[0]+","+a[1])+"');",2==a.length?(p="shareMyRDataDlg("+n+",'"+stringToHex(a[0]+","+a[1]+","+getCurrentEpoch()+","+authUserID+",")+"');|share",mobileAppDialog()||(p="hideDialog();"+p)):p="",d=""==f?d+addItem("data-"+n,n,"javascript:copyMyRDataFileNameToClipboard('data-"+n+"')",k,a[1],a[0],"","",p,m,l):d+addItem("data-"+n,n,"javascript:"+f+"("+n+");",k,a[1],a[0],"","",p,m,l));d=d+'<div style="margin-bottom:8px"></div>'+addItem("load-public-data",-2,"javascript:loadPublicRData();","img/download-40.png",
"Public Data","Press here to load public data","cloud");e+="$(\"#stat-data img.img-rounded\").attr(\"onclick\", \"setVar('stat-data-img',1,'');$(getIdBeginsWith('data-')).toggle();\");";""!=e&&(e="<script>"+e+"\x3c/script>");return d+e}(0,a);if(mobileAppDialog())return showMobileAppDialog(-1,-1,b,""),!1;setAppVar("onDlgShown","","");$("#wrap").html(b);showDialog(!0)}
function loadPublicRData(a,b){void 0==a&&(a=0);void 0==b&&(b=0);$("#load-public-data").data("del","");var c=getUploadDataFileUrl();c=c.replace("upload.php","public-data.php?index="+a);runSpinner(timeoutAjaxInMs);$.ajax({url:c,cache:!1,crossDomain:!0,dataType:"html",success:function(c){""==c?(viewErrorDlg("Information","No more data found."),$(getIdBeginsWith("public-data-prev","a")).remove()):0<=c.indexOf("Error")?viewErrorDlg("Error",c):showPublicRData(a+1,b,c)},error:function(a,b,c){addLog("loadPublicRData.error: "+
c)},complete:function(){stopSpinner()},timeout:timeoutAjaxInMs})}
function loadPublicDataDel(a,b,c){var d=getDownloadDataFileUrl()+"?filename=Data/public-data-del.txt";runSpinner(timeoutAjaxInMs);$.ajax({url:d,cache:!1,crossDomain:!0,dataType:"html",success:function(d){null==d&&(d="");d&&0>d.indexOf("error")?$("#load-public-data").data("del",d):$("#load-public-data").data("del","0");setTimeout(function(){showPublicRData(a,b,c)},0)},error:function(a,b,c){addLog("loadPublicDataDel.error: "+c)},complete:function(){stopSpinner()},timeout:timeoutAjaxInMs})}
function showPublicRData(a,b,c){if(!$("#load-public-data").data("del"))return setTimeout(function(){loadPublicDataDel(a,b,c)},0),!1;for(var d=c.split("\n"),e=d.length,f,h,g,k,l="",m=e-1;0<=m;m--)f=d[m],f=f.split(","),4<=f.length&&0>$("#load-public-data").data("del").indexOf(f[2])&&(h=getFileExt(f[0]),k=isMicrosoftExcel(f[0])?"img/ms-xls.png":"r"==h||"py"==h?"img/file.png":"img/doc.png",f[1]=deleteCRLFAtTheEnd(f[1]),g="copyMyRDataFileNameToClipboard('public-data-"+m+"-"+a+"');|ok",h=f[3]==authUserID?
"deletePublicData('public-data-"+m+"-"+a+"','"+f[0]+"','"+f[1]+"','"+f[2]+"');":"",l+=addItem("public-data-"+m+"-"+a,b,"javascript:copyMyRDataFileNameToClipboard('public-data-"+m+"-"+a+"')",k,f[1],f[0],"","",g,h),b++);""==l&&0==e?$.bootstrapGrowl("Unable to load public data",{type:"danger"}):1>=a?(""==l&&setTimeout(function(){loadPublicRData(a,b)},0),$(getIdBeginsWith("public-data","a")).remove(),l+=addItem("public-data-prev",-2,"javascript:loadPublicRData("+a+","+b+");","img/load-prev.png","More Public Data",
"Press here to load more public data","cloud"),l+='<div id="last-public-data"></div>',$("#load-public-data").after(l)):($(getIdBeginsWith("public-data-prev","a")).remove(),l+=addItem("public-data-prev",-2,"javascript:loadPublicRData("+a+","+b+");","img/load-prev.png","More Public Data","Press here to load more public data","cloud"),$("#last-public-data").before(l));scrollToBottom()}
function deleteShareDataUrl(a){var b=getUploadDataFileUrl();return b=b.replace("upload.php","share-data-del.php?uid="+userIDToAlpha()+"&time="+a)}
function deletePublicData(a,b,c,d){if(!isOnline(!0))return!1;confirmDlg('Do you wish to unshare data "'+c+'" ?',function(e){e&&(runSpinner(timeoutAjaxInMs),$.ajax({url:deleteShareDataUrl(d),cache:!1,crossDomain:!0,dataType:"html",success:function(d){null==d&&(d="");d&&0>d.indexOf("Error")?(actionToCloud(b,c,"Data file has been deleted"),$("#"+a).remove(),$.bootstrapGrowl(d,{type:"success"})):viewErrorDlg("Error",d)},error:function(a,b,c){addLog("deletePublicData.error: "+c)},complete:function(){stopSpinner()},
timeout:timeoutAjaxInMs}))},"Yes,No")}function injectJS(a){var b=document.createElement("script");b.type="text/javascript";b.text=a;document.getElementsByTagName("head")[0].appendChild(b)}$.cachedScript("https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.9/ace.js");
$(function(){if(mobileApp())if(setTouchAction(!1),setOnLogin(),"undefined"===typeof ace){var a=sdcStoreDir+getBinaryFileName(appFileName+"-ace-129.js"),b=fileToString(a);""!=b&&372916==b.length?(injectJS(b),showRConsoleMenu()):$.ajax({url:"https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.9/ace.js",cache:!1,crossDomain:!0,success:function(b){stringToFile(a,b);injectJS(b);showRConsoleMenu()},dataType:"html",timeout:3E4})}else showRConsoleMenu();else phoneGap()&&showRConsoleMenu();phoneGap()&&($("#watch-list").css("display",
"none"),debug=!1);$(".app-ver").length&&$(".app-ver").html($(".app-ver").html()+getAppVar("app-ver",""));webApp()&&setAppVar("on-login","RConsole();","");stopSpinner()});
